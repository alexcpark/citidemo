/*! Build 33379f3dda02  */
/*!
CryptoJS v3.1.2
code.google.com/p/crypto-js
(c) 2009-2013 by Jeff Mott. All rights reserved.
code.google.com/p/crypto-js/wiki/License
*/
var CryptoJS=CryptoJS||function(s,p){var m={},l=m.lib={},n=function(){},r=l.Base={extend:function(b){n.prototype=this;var h=new n;b&&h.mixIn(b);h.hasOwnProperty("init")||(h.init=function(){h.$super.init.apply(this,arguments)});h.init.prototype=h;h.$super=this;return h},create:function(){var b=this.extend();b.init.apply(b,arguments);return b},init:function(){},mixIn:function(b){for(var h in b)b.hasOwnProperty(h)&&(this[h]=b[h]);b.hasOwnProperty("toString")&&(this.toString=b.toString)},clone:function(){return this.init.prototype.extend(this)}},
q=l.WordArray=r.extend({init:function(b,h){b=this.words=b||[];this.sigBytes=h!=p?h:4*b.length},toString:function(b){return(b||t).stringify(this)},concat:function(b){var h=this.words,a=b.words,j=this.sigBytes;b=b.sigBytes;this.clamp();if(j%4)for(var g=0;g<b;g++)h[j+g>>>2]|=(a[g>>>2]>>>24-8*(g%4)&255)<<24-8*((j+g)%4);else if(65535<a.length)for(g=0;g<b;g+=4)h[j+g>>>2]=a[g>>>2];else h.push.apply(h,a);this.sigBytes+=b;return this},clamp:function(){var b=this.words,h=this.sigBytes;b[h>>>2]&=4294967295<<
32-8*(h%4);b.length=s.ceil(h/4)},clone:function(){var b=r.clone.call(this);b.words=this.words.slice(0);return b},random:function(b){for(var h=[],a=0;a<b;a+=4)h.push(4294967296*s.random()|0);return new q.init(h,b)}}),v=m.enc={},t=v.Hex={stringify:function(b){var a=b.words;b=b.sigBytes;for(var g=[],j=0;j<b;j++){var k=a[j>>>2]>>>24-8*(j%4)&255;g.push((k>>>4).toString(16));g.push((k&15).toString(16))}return g.join("")},parse:function(b){for(var a=b.length,g=[],j=0;j<a;j+=2)g[j>>>3]|=parseInt(b.substr(j,
2),16)<<24-4*(j%8);return new q.init(g,a/2)}},a=v.Latin1={stringify:function(b){var a=b.words;b=b.sigBytes;for(var g=[],j=0;j<b;j++)g.push(String.fromCharCode(a[j>>>2]>>>24-8*(j%4)&255));return g.join("")},parse:function(b){for(var a=b.length,g=[],j=0;j<a;j++)g[j>>>2]|=(b.charCodeAt(j)&255)<<24-8*(j%4);return new q.init(g,a)}},u=v.Utf8={stringify:function(b){try{return decodeURIComponent(escape(a.stringify(b)))}catch(g){throw Error("Malformed UTF-8 data");}},parse:function(b){return a.parse(unescape(encodeURIComponent(b)))}},
g=l.BufferedBlockAlgorithm=r.extend({reset:function(){this._data=new q.init;this._nDataBytes=0},_append:function(b){"string"==typeof b&&(b=u.parse(b));this._data.concat(b);this._nDataBytes+=b.sigBytes},_process:function(b){var a=this._data,g=a.words,j=a.sigBytes,k=this.blockSize,m=j/(4*k),m=b?s.ceil(m):s.max((m|0)-this._minBufferSize,0);b=m*k;j=s.min(4*b,j);if(b){for(var l=0;l<b;l+=k)this._doProcessBlock(g,l);l=g.splice(0,b);a.sigBytes-=j}return new q.init(l,j)},clone:function(){var b=r.clone.call(this);
b._data=this._data.clone();return b},_minBufferSize:0});l.Hasher=g.extend({cfg:r.extend(),init:function(b){this.cfg=this.cfg.extend(b);this.reset()},reset:function(){g.reset.call(this);this._doReset()},update:function(b){this._append(b);this._process();return this},finalize:function(b){b&&this._append(b);return this._doFinalize()},blockSize:16,_createHelper:function(b){return function(a,g){return(new b.init(g)).finalize(a)}},_createHmacHelper:function(b){return function(a,g){return(new k.HMAC.init(b,
g)).finalize(a)}}});var k=m.algo={};return m}(Math);
(function(s){function p(a,k,b,h,l,j,m){a=a+(k&b|~k&h)+l+m;return(a<<j|a>>>32-j)+k}function m(a,k,b,h,l,j,m){a=a+(k&h|b&~h)+l+m;return(a<<j|a>>>32-j)+k}function l(a,k,b,h,l,j,m){a=a+(k^b^h)+l+m;return(a<<j|a>>>32-j)+k}function n(a,k,b,h,l,j,m){a=a+(b^(k|~h))+l+m;return(a<<j|a>>>32-j)+k}for(var r=CryptoJS,q=r.lib,v=q.WordArray,t=q.Hasher,q=r.algo,a=[],u=0;64>u;u++)a[u]=4294967296*s.abs(s.sin(u+1))|0;q=q.MD5=t.extend({_doReset:function(){this._hash=new v.init([1732584193,4023233417,2562383102,271733878])},
_doProcessBlock:function(g,k){for(var b=0;16>b;b++){var h=k+b,w=g[h];g[h]=(w<<8|w>>>24)&16711935|(w<<24|w>>>8)&4278255360}var b=this._hash.words,h=g[k+0],w=g[k+1],j=g[k+2],q=g[k+3],r=g[k+4],s=g[k+5],t=g[k+6],u=g[k+7],v=g[k+8],x=g[k+9],y=g[k+10],z=g[k+11],A=g[k+12],B=g[k+13],C=g[k+14],D=g[k+15],c=b[0],d=b[1],e=b[2],f=b[3],c=p(c,d,e,f,h,7,a[0]),f=p(f,c,d,e,w,12,a[1]),e=p(e,f,c,d,j,17,a[2]),d=p(d,e,f,c,q,22,a[3]),c=p(c,d,e,f,r,7,a[4]),f=p(f,c,d,e,s,12,a[5]),e=p(e,f,c,d,t,17,a[6]),d=p(d,e,f,c,u,22,a[7]),
c=p(c,d,e,f,v,7,a[8]),f=p(f,c,d,e,x,12,a[9]),e=p(e,f,c,d,y,17,a[10]),d=p(d,e,f,c,z,22,a[11]),c=p(c,d,e,f,A,7,a[12]),f=p(f,c,d,e,B,12,a[13]),e=p(e,f,c,d,C,17,a[14]),d=p(d,e,f,c,D,22,a[15]),c=m(c,d,e,f,w,5,a[16]),f=m(f,c,d,e,t,9,a[17]),e=m(e,f,c,d,z,14,a[18]),d=m(d,e,f,c,h,20,a[19]),c=m(c,d,e,f,s,5,a[20]),f=m(f,c,d,e,y,9,a[21]),e=m(e,f,c,d,D,14,a[22]),d=m(d,e,f,c,r,20,a[23]),c=m(c,d,e,f,x,5,a[24]),f=m(f,c,d,e,C,9,a[25]),e=m(e,f,c,d,q,14,a[26]),d=m(d,e,f,c,v,20,a[27]),c=m(c,d,e,f,B,5,a[28]),f=m(f,c,
d,e,j,9,a[29]),e=m(e,f,c,d,u,14,a[30]),d=m(d,e,f,c,A,20,a[31]),c=l(c,d,e,f,s,4,a[32]),f=l(f,c,d,e,v,11,a[33]),e=l(e,f,c,d,z,16,a[34]),d=l(d,e,f,c,C,23,a[35]),c=l(c,d,e,f,w,4,a[36]),f=l(f,c,d,e,r,11,a[37]),e=l(e,f,c,d,u,16,a[38]),d=l(d,e,f,c,y,23,a[39]),c=l(c,d,e,f,B,4,a[40]),f=l(f,c,d,e,h,11,a[41]),e=l(e,f,c,d,q,16,a[42]),d=l(d,e,f,c,t,23,a[43]),c=l(c,d,e,f,x,4,a[44]),f=l(f,c,d,e,A,11,a[45]),e=l(e,f,c,d,D,16,a[46]),d=l(d,e,f,c,j,23,a[47]),c=n(c,d,e,f,h,6,a[48]),f=n(f,c,d,e,u,10,a[49]),e=n(e,f,c,d,
C,15,a[50]),d=n(d,e,f,c,s,21,a[51]),c=n(c,d,e,f,A,6,a[52]),f=n(f,c,d,e,q,10,a[53]),e=n(e,f,c,d,y,15,a[54]),d=n(d,e,f,c,w,21,a[55]),c=n(c,d,e,f,v,6,a[56]),f=n(f,c,d,e,D,10,a[57]),e=n(e,f,c,d,t,15,a[58]),d=n(d,e,f,c,B,21,a[59]),c=n(c,d,e,f,r,6,a[60]),f=n(f,c,d,e,z,10,a[61]),e=n(e,f,c,d,j,15,a[62]),d=n(d,e,f,c,x,21,a[63]);b[0]=b[0]+c|0;b[1]=b[1]+d|0;b[2]=b[2]+e|0;b[3]=b[3]+f|0},_doFinalize:function(){var a=this._data,k=a.words,b=8*this._nDataBytes,h=8*a.sigBytes;k[h>>>5]|=128<<24-h%32;var l=s.floor(b/
4294967296);k[(h+64>>>9<<4)+15]=(l<<8|l>>>24)&16711935|(l<<24|l>>>8)&4278255360;k[(h+64>>>9<<4)+14]=(b<<8|b>>>24)&16711935|(b<<24|b>>>8)&4278255360;a.sigBytes=4*(k.length+1);this._process();a=this._hash;k=a.words;for(b=0;4>b;b++)h=k[b],k[b]=(h<<8|h>>>24)&16711935|(h<<24|h>>>8)&4278255360;return a},clone:function(){var a=t.clone.call(this);a._hash=this._hash.clone();return a}});r.MD5=t._createHelper(q);r.HmacMD5=t._createHmacHelper(q)})(Math);
/*!
CryptoJS v3.1.2
code.google.com/p/crypto-js
(c) 2009-2013 by Jeff Mott. All rights reserved.
code.google.com/p/crypto-js/wiki/License
*/
var CryptoJS=CryptoJS||function(e,m){var p={},j=p.lib={},l=function(){},f=j.Base={extend:function(a){l.prototype=this;var c=new l;a&&c.mixIn(a);c.hasOwnProperty("init")||(c.init=function(){c.$super.init.apply(this,arguments)});c.init.prototype=c;c.$super=this;return c},create:function(){var a=this.extend();a.init.apply(a,arguments);return a},init:function(){},mixIn:function(a){for(var c in a)a.hasOwnProperty(c)&&(this[c]=a[c]);a.hasOwnProperty("toString")&&(this.toString=a.toString)},clone:function(){return this.init.prototype.extend(this)}},
n=j.WordArray=f.extend({init:function(a,c){a=this.words=a||[];this.sigBytes=c!=m?c:4*a.length},toString:function(a){return(a||h).stringify(this)},concat:function(a){var c=this.words,q=a.words,d=this.sigBytes;a=a.sigBytes;this.clamp();if(d%4)for(var b=0;b<a;b++)c[d+b>>>2]|=(q[b>>>2]>>>24-8*(b%4)&255)<<24-8*((d+b)%4);else if(65535<q.length)for(b=0;b<a;b+=4)c[d+b>>>2]=q[b>>>2];else c.push.apply(c,q);this.sigBytes+=a;return this},clamp:function(){var a=this.words,c=this.sigBytes;a[c>>>2]&=4294967295<<
32-8*(c%4);a.length=e.ceil(c/4)},clone:function(){var a=f.clone.call(this);a.words=this.words.slice(0);return a},random:function(a){for(var c=[],b=0;b<a;b+=4)c.push(4294967296*e.random()|0);return new n.init(c,a)}}),b=p.enc={},h=b.Hex={stringify:function(a){var c=a.words;a=a.sigBytes;for(var b=[],d=0;d<a;d++){var f=c[d>>>2]>>>24-8*(d%4)&255;b.push((f>>>4).toString(16));b.push((f&15).toString(16))}return b.join("")},parse:function(a){for(var c=a.length,b=[],d=0;d<c;d+=2)b[d>>>3]|=parseInt(a.substr(d,
2),16)<<24-4*(d%8);return new n.init(b,c/2)}},g=b.Latin1={stringify:function(a){var c=a.words;a=a.sigBytes;for(var b=[],d=0;d<a;d++)b.push(String.fromCharCode(c[d>>>2]>>>24-8*(d%4)&255));return b.join("")},parse:function(a){for(var c=a.length,b=[],d=0;d<c;d++)b[d>>>2]|=(a.charCodeAt(d)&255)<<24-8*(d%4);return new n.init(b,c)}},r=b.Utf8={stringify:function(a){try{return decodeURIComponent(escape(g.stringify(a)))}catch(c){throw Error("Malformed UTF-8 data");}},parse:function(a){return g.parse(unescape(encodeURIComponent(a)))}},
k=j.BufferedBlockAlgorithm=f.extend({reset:function(){this._data=new n.init;this._nDataBytes=0},_append:function(a){"string"==typeof a&&(a=r.parse(a));this._data.concat(a);this._nDataBytes+=a.sigBytes},_process:function(a){var c=this._data,b=c.words,d=c.sigBytes,f=this.blockSize,h=d/(4*f),h=a?e.ceil(h):e.max((h|0)-this._minBufferSize,0);a=h*f;d=e.min(4*a,d);if(a){for(var g=0;g<a;g+=f)this._doProcessBlock(b,g);g=b.splice(0,a);c.sigBytes-=d}return new n.init(g,d)},clone:function(){var a=f.clone.call(this);
a._data=this._data.clone();return a},_minBufferSize:0});j.Hasher=k.extend({cfg:f.extend(),init:function(a){this.cfg=this.cfg.extend(a);this.reset()},reset:function(){k.reset.call(this);this._doReset()},update:function(a){this._append(a);this._process();return this},finalize:function(a){a&&this._append(a);return this._doFinalize()},blockSize:16,_createHelper:function(a){return function(c,b){return(new a.init(b)).finalize(c)}},_createHmacHelper:function(a){return function(b,f){return(new s.HMAC.init(a,
f)).finalize(b)}}});var s=p.algo={};return p}(Math);
(function(){var e=CryptoJS,m=e.lib,p=m.WordArray,j=m.Hasher,l=[],m=e.algo.SHA1=j.extend({_doReset:function(){this._hash=new p.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(f,n){for(var b=this._hash.words,h=b[0],g=b[1],e=b[2],k=b[3],j=b[4],a=0;80>a;a++){if(16>a)l[a]=f[n+a]|0;else{var c=l[a-3]^l[a-8]^l[a-14]^l[a-16];l[a]=c<<1|c>>>31}c=(h<<5|h>>>27)+j+l[a];c=20>a?c+((g&e|~g&k)+1518500249):40>a?c+((g^e^k)+1859775393):60>a?c+((g&e|g&k|e&k)-1894007588):c+((g^e^
k)-899497514);j=k;k=e;e=g<<30|g>>>2;g=h;h=c}b[0]=b[0]+h|0;b[1]=b[1]+g|0;b[2]=b[2]+e|0;b[3]=b[3]+k|0;b[4]=b[4]+j|0},_doFinalize:function(){var f=this._data,e=f.words,b=8*this._nDataBytes,h=8*f.sigBytes;e[h>>>5]|=128<<24-h%32;e[(h+64>>>9<<4)+14]=Math.floor(b/4294967296);e[(h+64>>>9<<4)+15]=b;f.sigBytes=4*e.length;this._process();return this._hash},clone:function(){var e=j.clone.call(this);e._hash=this._hash.clone();return e}});e.SHA1=j._createHelper(m);e.HmacSHA1=j._createHmacHelper(m)})();
/*!
* Date Format 1.2.3
* (c) 2007-2009 Steven Levithan <stevenlevithan.com>
* MIT license
* Includes enhancements by Scott Trenda <scott.trenda.net>
* and Kris Kowal <cixar.com/~kris.kowal/>
* The dateFormat function has been modified to avoid namespace conflict. It has been intergrated into bvVisualize.js
*/
/*!
 * <progress> polyfill by Lea Verou, under MIT license 
 * @author Lea Verou http://leaverou.me
 * https://github.com/LeaVerou/HTML5-Progress-polyfill
 * The js and css files have been customized and intergrated into bvVisualize.js
 */
/*

Badgeville JS SDK Preconfigured Visualizations
Version 1.3.8

Copyright 2014 Badgeville, Inc.

Licensed under Badgeville's Free Software License Agreement (the "License"); you may not use this file except
in compliance with the License. You may obtain a copy of the License at http://source.badgeville.com/license
Unless required by applicable law or mutually agreed to in writing, software distributed under the License is 
distributed on an "AS-IS" BASIS, WITHOUT WARRANTIES, COMMITMENTS OR LIABILITY OF ANY KIND, either express or 
implied. See the License for the specific language governing rights, permissions, restrictions and limitations 
under the License.

*/
var BVVIZ={};(function(a){BVVIZ={options:{leaderboard:{isHorizontal:false,pageSize:10,headerTitle:"Leaderboard",loadRelative:true,showMeIndex:3,activeOnLoad:0},playerProfile:{unitBar:{modules:["units","level","expertise","teams","activities"],titles:{level:"Level",expertise:"Expertise",teams:"Teams",activities:"Recent Activity"}}},playerCard:{unitBar:{modules:["units","level","expertise","teams","activities"],titles:{level:"Level",expertise:"Expertise",teams:"Teams",activities:"Recent Activity"}}},playerHeader:{unitBar:{singleLine:true,modules:["units","level","expertise","teams"]},pageSize:30},playerRow:{maxIcons:4},playerRewards:{inline:false,headerTitle:"Rewards",pageSize:10,maxPageSize:30,category:null,childContentCards:false,beforeRequestCallback:null,callback:null,badges:{badgeBackgroundColor:"",badgeFontColor:"",showBadgeBorder:true,showName:true,showCategory:false,showProgress:true,showUnearned:true,lockUnearned:false,miniBadge:false}},playerMissions:{inline:false,headerTitle:"Mission Cards",pageSize:10,maxPageSize:10,category:null,childContentCards:false,beforeRequestCallback:null,callback:null,badges:{badgeBackgroundColor:"",badgeFontColor:"",showBadgeBorder:true,showName:true,showProgress:true,showCategory:false,miniBadge:false}},playerTracks:{inline:false,headerTitle:"Track Cards",pageSize:10,maxPageSize:10,category:null,childContentCards:false,beforeRequestCallback:null,callback:null,badges:{badgeBackgroundColor:"",badgeFontColor:"",showBadgeBorder:true,showName:true,showProgress:true,showCategory:false,miniBadge:false}},missionProgress:{inline:false,pageSize:10,maxPageSize:10},missionRewards:{inline:false,showContainerFrame:true,headerTitle:"",showDescription:false,description:"",descriptionFontColor:"",pageSize:10,maxPageSize:10,childContentCards:false,badges:{badgeBackgroundColor:"",badgeFontColor:"",showBadgeBorder:true,showName:true,showProgress:true,showUnearned:true,lockUnearned:false,miniBadge:false}},trackProgress:{inline:false,pageSize:10,maxPageSize:10},trackMissions:{inline:false,showContainerFrame:true,headerTitle:"",showDescription:false,description:"",descriptionFontColor:"",pageSize:10,maxPageSize:10,childContentCards:false,badges:{badgeBackgroundColor:"",badgeFontColor:"",showBadgeBorder:true,showName:true,showProgress:true,miniBadge:false}},customContainer:{inline:true,showContainerFrame:true,headerTitle:"Achievements",showDescription:true,description:"",descriptionFontColor:"",category:"",contentsTypes:["tracks","missions","rewards"],contents:{pageSize:0,childContentCards:true,badges:{badgeBackgroundColor:"",badgeFontColor:"",showBadgeBorder:true,showName:true,showProgress:true,showCategory:false,showUnearned:true,lockUnearned:true,miniBadge:false}}}},setOptions:function(c,b){var d={};if(BVVIZ.utility.validateNestedObj(BVVIZ.options,c)){if(c==="playerHeader"){d={unitBar:{singleLine:true}}}BVVIZ.options[c]=BVVIZ.utility.recursiveOverwrite(BVVIZ.options[c],b,d)}else{return false}},helper:{loading:function(b){return a('<div class="bvviz-loading'+(b?" "+b:"")+'"><span id="bvviz-loading_1"></span><span id="bvviz-loading_2"></span><span id="bvviz-loading_3"></span></div>')},showError:function(b,c){if(a.isPlainObject(c)){b.html("");throw new Error("Badgeville JSSDK Error "+c.errors[0].code+": "+c.errors[0].messages[0])}else{b.html("");throw new Error(c)}},showModal:function(e,b,c){var d=a("<div></div>");c=a.extend({modal:true,show:400,width:380,height:490,resizable:false,draggable:false,dialogClass:"bvviz",open:function(){var f=a(".ui-dialog:last");b.unshift(a(this));e.apply(BVVIZ,b);a(".ui-widget-overlay:last").one("click",function(){a(".ui-dialog-titlebar-close",f).trigger("click")})},close:function(){d.dialog("destroy");d.remove()}},c);d.appendTo("body").dialog(c)},unitBar:function(d,b,c){window.setTimeout(function(){var i=a('<div class="bvviz-unitbar-items"></div>'),g=a('<div class="bvviz-unitbar-container"></div>'),l=a('<div class="bvviz-unitbar-boundry"></div>'),u=0,q=d.width(),e,m,f,j,k,h,p=0;c=a.isPlainObject(c)?c:{};if(c.visualization==="playerCard"){k=a.extend({},BVVIZ.options.playerCard.unitBar,c)}else{if(c.visualization==="playerHeader"){k=a.extend({},BVVIZ.options.playerHeader.unitBar,c)}else{k=a.extend({},BVVIZ.options.playerProfile.unitBar,c)}}h={units:function(w){var x=BVVIZ.utility.validateNestedObj(k,"titles","units")?k.titles.units:"",v=a('<div class="bvviz-unit">').append(x?a('<div class="bvviz-title bvviz-line">'+x+"</div>"):"",a('<div class="bvviz-table">').append(a('<div class="bvviz-row">').append(a('<div class="bvviz-cell bvviz-units-rightalign bvviz-value">'+w.units.points.all+"</div>"),a('<div class="bvviz-cell bvviz-units-leftalign bvviz-value">'+w.units.points.display_name+"</div>"))));a.each(w.units,function(y,z){p++;if(y==="points"){return true}if(p>3){return false}v.find(".bvviz-table").append(a('<div class="bvviz-row">').append(a('<div class="bvviz-cell bvviz-units-rightalign bvviz-value">'+z.all+"</div>"),a('<div class="bvviz-cell bvviz-units-leftalign bvviz-value">'+z.display_name+"</div>")))});return v},basic_unit:function(v){var v=a('<div class="bvviz-unit">').append(a('<div class="bvviz-units-rightalign bvviz-value">'+v.all+"</div>"),a('<div class="bvviz-units-leftalign bvviz-label">'+v.display_name+"</div>"));return v},teams:function(v){var x=BVVIZ.utility.validateNestedObj(k,"titles","teams")?k.titles.teams:"",w=a('<div class="bvviz-unit">').append(x?a('<div class="bvviz-title bvviz-line">'+x+"</div>"):"");a.each(v.teams,function(z,y){if(z>=3){return}w.append(a('<div class="bvviz-label">'+y.display_name+"</div>"))});return w},basic_team:function(v){var v=a('<div class="bvviz-unit">').append(a('<div class="bvviz-label">'+v.display_name+"</div>"));return v},level:function(v){var w=BVVIZ.utility.validateNestedObj(k,"titles","level")?k.titles.level:"",x=a('<div class="bvviz-unit bvviz-level">').append(w?a('<div class="bvviz-title bvviz-line">'+w+"</div>"):"");if(a.isFunction(BVVIZ.levelProgress)){BVVIZ.levelProgress(a("<div></div>").appendTo(x),b.id,v.mission_id)}return x},basic_level:function(v){var w=a('<div class="bvviz-unit bvviz-basic">').append(a('<img src="'+v.image+'" />'),a('<span class="bvviz-label">'+v.name+"</span>"));return w},track:function(v){var w=BVVIZ.utility.validateNestedObj(k,"titles","expertise")?k.titles.expertise:"",v=a('<div class="bvviz-unit bvviz-track">').append(w?a('<div class="bvviz-title bvviz-line">'+w+"</div>"):"",a('<div class="bvviz-flex">').append(a('<div class="bvviz-flex-item-1 bvviz-units-rightalign">').append(a('<img src="'+v.last_earned.image+'" />')),a('<div class="bvviz-flex-item-2 bvviz-label bvviz-units-leftalign"><br>'+v.last_earned.name+"</div>")));return v},basic_track:function(v){var v=a('<div class="bvviz-unit bvviz-basic">').append(a('<img src="'+v.last_earned.image+'" />'),a('<span class="bvviz-label">'+v.last_earned.name+"</span>"));return v},activities:function(x){var A=BVVIZ.utility.validateNestedObj(k,"titles","activities")?k.titles.activities:"",z=BVVIZ.utility.validateNestedObj(x,"behaviors",[0],"image")?x.behaviors[0].image:BVVIZ.helper.imageHolderSrc(),w=BVVIZ.utility.validateNestedObj(x,"behaviors",[0],name)?x.behaviors[0].name:(BVVIZ.utility.validateNestedObj(x,"verb")?x.verb:""),y=BVVIZ.utility.validateNestedObj(x,"created_at")?x.created_at:new Date(),v=a('<div class="bvviz-unit bvviz-activity">').append(A?a('<div class="bvviz-title bvviz-line">'+A+"</div>"):"",a('<div class="bvviz-flex">').append(a('<div class="bvviz-flex-item-1">').append(z.match(/^[\w\s]*$/)?a('<span class="bvviz-sprite-icon '+z+'"></span>'):a('<img src="'+z+'" />')),a('<div class="bvviz-flex-item-3 bvviz-label bvviz-units-leftalign">'+w+"<br>"+BVVIZ.helper.timeToFormatted(y,"mm/dd/yyyy")+"</div>")));return v}};function r(){if(k.singleLine){if(a.isPlainObject(b.units.points)){g.append(h.basic_unit(b.units.points))}a.each(b.units,function(v,w){if(v==="points"){return true}g.append(h.basic_unit(w))})}else{g.append(h.units(b))}}function s(){if(a.isArray(b["rewards:currentlevels"])){a.each(b["rewards:currentlevels"],function(v,w){if(k.singleLine){g.append(h.basic_level(w))}else{g.append(h.level(w))}})}}function o(){if(a.isArray(b["progresses:all_tracks"])){b["progresses:all_tracks"].sort(function(w,v){return v.percent-w.percent});a.each(b["progresses:all_tracks"],function(x,w){var v;if(w.percent>0&&w.type==="level_track"){v=k.singleLine?h.basic_track(w):h.track(w);if(a.isFunction(BVVIZ.trackProgress)){v.click(function(y){if(!g.data("dragging")){BVVIZ.helper.showModal(BVVIZ.trackProgress,[b.id,w.definition_id])}y.preventDefault();return false})}g.append(v)}})}}function t(){if(a.isArray(b.teams)){if(k.singleLine){a.each(b.teams,function(w,v){g.append(h.basic_team(v))})}else{if(BVVIZ.utility.validateNestedObj(b,"teams")&&b.teams.length>0){g.append(h.teams(b))}}}}function n(){if(a.isArray(b.activities)&&b.activities[0]&&!k.singleLine){g.append(h.activities(b.activities[0]))}}a.each(k.modules,function(v,w){switch(w){case"units":r();break;case"level":s();break;case"expertise":o();break;case"teams":t();break;case"activities":n();break}});d.addClass("bvviz bvviz-unitbar").append(a('<div class="bvviz-units-arrow bvviz-units-left">&#10216;</div>'),a('<div class="bvviz-units-arrow bvviz-units-right">&#10217;</div>'),a('<div class="bvviz-units-fade bvviz-units-leftFade"></div>'),a('<div class="bvviz-units-fade bvviz-units-rightFade"></div>'),i.append(l.append(g)));u+=k.singleLine?0:5;g.children().each(function(){u+=a(this).outerWidth(true)});g.children(":last").addClass("bvviz-last");g.append('<div class="bvviz-clear"></div>');if(q<u){m=d.find(".bvviz-units-arrow.bvviz-units-right");e=d.find(".bvviz-units-arrow.bvviz-units-left").hide();f=Math.abs(q-u);j=g.children().first().outerWidth(true);l.width(u+(u-q)).css("left",(q-u));g.width(u).css("left",(u-q));g.css("cursor","ew-resize").draggable({containment:l,axis:"x",start:function(v,w){w.helper.data("dragging",true)},stop:function(v,w){setTimeout(function(){w.helper.data("dragging",false)},1);e.show();m.show();if(w.position.left===0){m.hide()}else{if(w.position.left>=f){e.hide()}}}});m.click(function(w){var v=parseInt(g.css("left"));if(v>0){g.animate({left:Math.max(v-j,0)});e.show();if(Math.max(v-j,0)===0){m.hide()}}w.preventDefault();return false});e.click(function(w){var v=parseInt(g.css("left"));if(v<f){g.animate({left:Math.min(v+j,f)});m.show();if(Math.min(v+j,f)===f){e.hide()}}w.preventDefault();return false})}else{d.find(".bvviz-units-arrow").remove()}},1)},showCards:function(c){var b=a(".bvviz-card.bvviz-invisible:first",c);if(b.length){b.removeClass("bvviz-invisible").hide().fadeIn({complete:function(){BVVIZ.helper.showCards(c)},duration:100})}},showCollection:function(c){var b=a(c).filter(".bvviz-invisible").first();if(b.length){b.removeClass("bvviz-invisible").hide().fadeIn({complete:function(){BVVIZ.helper.showCollection(c)},duration:100})}},infiniteScroll:function(b,c){a(b).bind("scroll.bvviz",function(g){var d=a(g.currentTarget),f;if(a(".bvviz-loading",d.closest(".bvviz")).length>0){return}if(d[0].scrollHeight-d.scrollTop()>d.outerHeight(true)+(a(".bvviz-show-scroll",d).height()/2)){return}if(a(".bvviz-loading",d).length>0){return}BVVIZ.helper.loadNextPage(d,c);return false})},infiniteHorizontalScroll:function(b,c){a(b).parent().bind("scroll.bvviz",function(g){var d=a(g.currentTarget),f;if(a(".bvviz-loading",d.closest(".bvviz")).length>0){return}if(d[0].scrollWidth-d.scrollLeft()>d.outerWidth(true)+(a(".bvviz-show-scroll",d).width()/2)){return}if(a(".bvviz-loading",d).length>0){return}BVVIZ.helper.loadNextPage(d,c);return false})},infiniteUpDownScroll:function(b,d){var c=b.scrollTop(),e=true;a(b).bind("scroll.bvviz",function(i){var h=a(i.currentTarget),g=a(".bvviz-show-scroll.bvviz-previous",h),j=a(".bvviz-show-scroll.bvviz-next",h),f=h.scrollTop();if(a(".bvviz-loading",h.closest(".bvviz")).length>0){return}if(a(".bvviz-loading",h).length>0){return}if(e&&g.length){c=f;e=false;return}if(f>c){c=f;if(!j.length){return}if(!i.isTrigger&&h[0].scrollHeight-h.scrollTop()>h.outerHeight(true)+(j.height()/2)){return}a(h).trigger("load-next.bvviz");return false}else{c=f;if(!g.length){return}if(!i.isTrigger&&h.scrollTop()>(g.height()/2)){return}a(h).trigger("load-previous.bvviz");return false}return false})},infiniteLeftRightScroll:function(b,d){var c=b.scrollLeft(),e=true;a(b).parent().bind("scroll.bvviz",function(j){var h=a(j.currentTarget),i=h.find(".bvviz-cards"),k=a(".bvviz-show-scroll.bvviz-previous",h),g=a(".bvviz-show-scroll.bvviz-next",h),f=h.scrollLeft();if(a(".bvviz-loading",h.closest(".bvviz")).length>0){return}if(a(".bvviz-loading",h).length>0){return}if(e&&k.length){c=f;e=false;return}if(f>c){c=f;if(!g.length){return}if(!j.isTrigger&&h[0].scrollWidth-h.scrollLeft()>h.outerWidth(true)+(g.width()/2)){return}a(i).trigger("load-next.bvviz");return false}else{c=f;if(!k.length){return}if(!j.isTrigger&&h.scrollLeft()>(k.width()/2)){return}a(i).trigger("load-previous.bvviz");return false}return false})},customLoadPrevious:function(b,c){a(b).bind("load-previous.bvviz",function(g){var f=b.data("bvviz-offset-start")||0,d=b.data("bvviz-pagesize")||10;c.load(f-d,"previous")})},customLoadNext:function(b,c){a(b).bind("load-next.bvviz",function(f){var d=b.data("bvviz-offset-end")||10;c.load(d,"next")})},loadNextPage:function(b,d){var c=b.data("bvviz-page")||1;b.data("bvviz-page",c+1);d.load(c)},fitHeight:function(g){var b=a(".bvviz-body",g),f=a(".bvviz-cards:visible",b),i=0,d=0,e,c,h;e=b.outerHeight(true)-b.height();c=f.outerHeight(true)-f.height();b.siblings(":visible").each(function(j,k){i+=a(k).outerHeight(true)});f.siblings(":visible").each(function(j,k){d+=a(k).outerHeight(true)});h=b.parent().height()<b.outerHeight(true)+i;if(h){b.height(b.parent().height()-i-e)}else{b.height(b.height()+b.parent().height()-b.outerHeight(true)-i)}f.height(b.height()-c-d)},fitWidth:function(h){var g=a(".bvviz-body",h),b=a(".bvviz-cards:visible",g),c=a(".bvviz-card",b),i=0,f=0,e,j,d;e=g.outerWidth(true)-g.width();j=b.outerWidth(true)-b.width();cardsWrapperBorder=b.parent().outerHeight(true)-b.parent().height()+0.5;g.siblings(":visible").each(function(k,l){i+=a(l).outerWidth(true)});b.parent().siblings(":visible").each(function(k,l){f+=a(l).outerWidth(true)});d=g.parent().width()<g.outerWidth(true)+i||b.width()<c.outerWidth(true)*c.size();if(d){g.width(g.parent().width()-i-e);b.parent().width(g.width()-j-f-cardsWrapperBorder);b.width(c.outerWidth(true)*c.size())}else{g.width(g.width()+g.parent().width()-g.outerWidth(true)-i);b.width(g.width()-j-f-cardsWrapperBorder)}},fitRowCardWidth:function(d,g){var f=g[0].offsetWidth-g[0].clientWidth,c=g.innerWidth()-f,e=d.outerWidth(true)-d.width(),b=parseInt(c/d.outerWidth(),10)||1;return c/b-e-0.5},fitContainerCardWidth:function(e,c){var g=c.find(".bvviz-cards:first"),d=g.innerWidth(),f=e.outerWidth(true)-e.width(),b=parseInt(d/e.outerWidth(),10)||1;return d/b-f-0.5},timeToString:function(d){var b;function c(){var k=new Date(),i=new Date(BVVIZ.utility.parseDateString(d)),f=["January","February","March","April","May","June","July","August","September","October","November","December"],h,o,n,j,l,p,e,m,g;h=k.getTime()-i.getTime();g=(h<0)?true:false;h=Math.abs(h);n=h/1000;j=n/60;l=j/60;p=l/24;e=p/7;if(n<60){o="second"+((m=n)>=2?"s":"")}else{if(j<60){o="minute"+((m=j)>=2?"s":"")}else{if(l<24){o="hour"+((m=l)>=2?"s":"")}else{if(p<7){o="day"+((m=p)>=2?"s":"")}else{if(e<10){o="week"+((m=e)>=2?"s":"")}else{return(g?"on ":"")+f[i.getMonth()]+" "+i.getDate()+", "+i.getFullYear()}}}}}return +(g?"in ":"")+Math.max(1,Math.floor(m))+" "+o+(g?"":" ago")}b=a('<div class="bvviz-timestamp">'+c()+"</div>").bind("bvviz.timestamp",function(){b.html(c())});BVVIZ.utility.timestampRunner.schedule(d);return b},timeToFormatted:function(c,b){b=a.type(b)==="string"?b:"mm/dd/yyyy HH:MMTT";return BVVIZ.dateFormat(new Date(BVVIZ.utility.parseDateString(c)),b)},svgCheckmarkCorner:function(){return'<svg xmlns="http://www.w3.org/2000/svg" width="41.45" height="41.45" viewBox="0 0 41.45 41.45"><path class="bvviz-checkmark-bg" fill="" d="M5.9 0C2.6 0 0 2.6 0 5.9v33.4L39.3 0H5.9z"/><path fill="#D8D3CD" d="M0 41.45L41.45 0h-2.217L0 39.235"/><path fill="#FFF" d="M21.725 7.84L19.61 5.65l-7.5 7.772-3.27-3.437-2.115 2.19 5.377 5.65"/></svg>'},svgCheckmarkMini:function(){return'<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12"><path class="bvviz-checkmark-mini" fill="#37A6DE" d="M12 2.8L10.3 1l-6 6.2-2.6-2.8L0 6.2l4.3 4.6 7.7-8z"/></svg>'},svgCheckmarkCircle:function(){return'<svg xmlns="http://www.w3.org/2000/svg" width="27" height="27" viewBox="0 0 27 27"><path class="bvviz-checkmark-bg" fill="#fff" d="M13.5 24.9c-6.1 0-11.4-5.1-11.4-11.4S7.2 2.2 13.5 2.2s11.4 4.9 11.4 11.4S20 24.9 13.5 24.9z"/><path class="bvviz-checkmark-border" fill="#D2D2D2" d="M13.5 0C6.2 0 0 6 0 13.5S6.1 27 13.5 27 27 20.8 27 13.5 21.2 0 13.5 0zm0 24.9c-6.1 0-11.4-5.1-11.4-11.4S7.2 2.2 13.5 2.2s11.4 4.9 11.4 11.4S20 24.9 13.5 24.9z"/><path class="bvviz-checkmark-check" fill="#36A8DE" d="M11.7 15.4L8 11.9l-2.5 2.2 6.2 6.1L21.8 9.6l-2.2-2.5"/></svg>'},imageHolderSrc:function(){return"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"}},utility:{isIe8OrLess:function(){var b=document.createElement("div");b.innerHTML="<!--[if lt IE 9]><i></i><![endif]-->";return(b.getElementsByTagName("i").length==1)},trimArray:function(b){if(a.type(b)==="array"){for(var c=0;c<b.length;c++){b[c]=b[c].trim()}}},validateNestedObj:function(d){var b=Array.prototype.slice.call(arguments,1);for(var c=0;c<b.length;c++){if(!d||!d.hasOwnProperty(b[c])){return false}d=d[b[c]]}return true},recursiveOverwrite:function(b){var c;a.each(Array.prototype.slice.call(arguments,1),function(d,e){if(e){for(c in e){if(e[c].constructor===Object){if(!b[c]||b[c].constructor===Object){b[c]=b[c]||{};BVVIZ.utility.recursiveOverwrite(b[c],e[c])}else{if(b[c].constructor===e[c].constructor){b[c]=e[c]}else{delete e[c]}}}else{if(b[c]&&b[c].constructor===e[c].constructor){b[c]=e[c]}else{delete e[c]}}}}});return b},parseDateString:function(c){var f=0,d,e=60*60*1000,b=/^\s*(\d{4})\-(\d{1,2})\-(\d{1,2})T(\d{2}):(\d{2}):(\d{2})\.?(\d{3})?Z?((\-)(\d{2}):(\d{2}))?\s*$/.exec(c);if(a.isArray(b)){f=Date.UTC(b[1],--b[2],+b[3],+b[4]||0,+b[5]||0,+b[6]||0);d=parseInt(b[10],10);if(d>0){if(b[9]==="-"){f+=e*d}else{f-=e*d}}}else{if(a.type(c)==="date"){f=c.getTime()}else{if(a.type(c)==="string"){b=c.split("-");f=Date.UTC(b[0],parseInt(b[1])-1,b[2].split("T")[0])}}}return f},timestampRunner:{options:{minLen:10000,maxLen:60000,scaleRate:0.5},job:null,time:null,timeoutLen:null,schedule:function(e){var c=new Date().getTime(),b,d;if(e){b=c-new Date(BVVIZ.utility.parseDateString(e)).getTime()}else{b=this.timeoutLen+Math.floor(this.timeoutLen*this.options.scaleRate)}b=b<this.options.minLen?this.options.minLen:(b>this.options.maxLen?this.options.maxLen:b);if(isNaN(b)){return false}d=c+b;if(this.job==null||d<this.time){if(this.job!=null){window.clearTimeout(this.job)}this.job=window.setTimeout(function(){a(".bvviz-timestamp").trigger("bvviz.timestamp");BVVIZ.utility.timestampRunner.job=null;BVVIZ.utility.timestampRunner.schedule(false)},b);this.time=d;this.timeoutLen=b;return true}return false}}},dateFormat:function(){var b=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,c=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,e=/[^-+\dA-Z]/g,d=function(g,f){g=String(g);f=f||2;while(g.length<f){g="0"+g}return g};return function(j,w,r){var h=BVVIZ.dateFormat;if(arguments.length==1&&Object.prototype.toString.call(j)=="[object String]"&&!/\d/.test(j)){w=j;j=undefined}j=j?new Date(j):new Date;if(isNaN(j)){throw SyntaxError("invalid date")}w=String(BVVIZ.dateFormatMasks[w]||w||BVVIZ.dateFormatMasks["default"]);if(w.slice(0,4)=="UTC:"){w=w.slice(4);r=true}var u=r?"getUTC":"get",n=j[u+"Date"](),f=j[u+"Day"](),k=j[u+"Month"](),q=j[u+"FullYear"](),t=j[u+"Hours"](),l=j[u+"Minutes"](),v=j[u+"Seconds"](),p=j[u+"Milliseconds"](),g=r?0:j.getTimezoneOffset(),i={d:n,dd:d(n),ddd:BVVIZ.dateFormati18n.dayNames[f],dddd:BVVIZ.dateFormati18n.dayNames[f+7],m:k+1,mm:d(k+1),mmm:BVVIZ.dateFormati18n.monthNames[k],mmmm:BVVIZ.dateFormati18n.monthNames[k+12],yy:String(q).slice(2),yyyy:q,h:t%12||12,hh:d(t%12||12),H:t,HH:d(t),M:l,MM:d(l),s:v,ss:d(v),l:d(p,3),L:d(p>99?Math.round(p/10):p),t:t<12?"a":"p",tt:t<12?"am":"pm",T:t<12?"A":"P",TT:t<12?"AM":"PM",Z:r?"UTC":(String(j).match(c)||[""]).pop().replace(e,""),o:(g>0?"-":"+")+d(Math.floor(Math.abs(g)/60)*100+Math.abs(g)%60,4),S:["th","st","nd","rd"][n%10>3?0:(n%100-n%10!=10)*n%10]};return w.replace(b,function(m){return m in i?i[m]:m.slice(1,m.length-1)})}}(),dateFormatMasks:{"default":"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"},dateFormati18n:{dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]}}})(jQuery);if(!Array.prototype.filter){Array.prototype.filter=function(c){if(this===void 0||this===null){throw new TypeError()}var f=Object(this);var a=f.length>>>0;if(typeof c!=="function"){throw new TypeError()}var e=[];var b=arguments.length>=2?arguments[1]:void 0;for(var d=0;d<a;d++){if(d in f){var g=f[d];if(c.call(b,g,d,f)){e.push(g)}}}return e}}if(!String.prototype.trim){String.prototype.trim=function(){return this.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}}(function(){if("position" in document.createElement("progress")){return}var c,b=true;if(Object.defineProperty){c=function(m,k,i){i.enumerable=true;i.configurable=true;try{Object.defineProperty(m,k,i)}catch(l){if(l.number===-2146823252){i.enumerable=false;Object.defineProperty(m,k,i)}}}}else{if("__defineSetter__" in document.body){c=function(k,i,e){k.__defineGetter__(i,e.get);if(e.set){k.__defineSetter__(i,e.set)}}}else{c=function(k,i,e){k[i]=e.get.call(k)},b=false}}try{[].slice.apply(document.images);var a=function(e){return[].slice.apply(e)}}catch(h){var a=function(m){var k=[],e=m.length;for(var l=0;l<e;l++){k[l]=m[l]}return k}}var g=(function(){var i=document.createElement("div");i.foo="bar";return i.getAttribute("foo")==="bar"})();var d=window.ProgressPolyfill={DOMInterface:{max:{get:function(){return parseFloat(this.getAttribute("aria-valuemax"))||1},set:function(e){this.setAttribute("aria-valuemax",e);if(!g){this.setAttribute("max",e)}d.redraw(this)}},value:{get:function(){return parseFloat(this.getAttribute("aria-valuenow"))||0},set:function(e){e=Math.min(e,this.max);this.setAttribute("aria-valuenow",e);if(!g){this.setAttribute("value",e)}d.redraw(this)}},position:{get:function(){return this.hasAttribute("aria-valuenow")?this.value/this.max:-1}},labels:{get:function(){var e=this.parentNode;while(e&&!/^label$/i.test(e.nodeName)){e=e.parentNode}var k=e?[e]:[];if(this.id&&document.querySelectorAll){var i=a(document.querySelectorAll('label[for="'+this.id+'"]'));if(i.length){k=k.concat(i)}}return k}}},redraw:function j(e){if(!d.isInited(e)){d.init(e)}else{if(!g){e.setAttribute("aria-valuemax",parseFloat(e.getAttribute("max"))||1);if(e.hasAttribute("value")){e.setAttribute("aria-valuenow",parseFloat(e.getAttribute("value"))||0)}else{e.removeAttribute("aria-valuenow")}}}if(e.position!==-1){e.style.paddingRight=e.offsetWidth*(1-e.position)+"px"}},isInited:function(e){return e.getAttribute("role")==="progressbar"},init:function(e){if(d.isInited(e)){return}e.setAttribute("role","progressbar");e.setAttribute("aria-valuemin","0");e.setAttribute("aria-valuemax",parseFloat(e.getAttribute("max"))||1);if(e.hasAttribute("value")){e.setAttribute("aria-valuenow",parseFloat(e.getAttribute("value"))||0)}for(var i in d.DOMInterface){c(e,i,{get:d.DOMInterface[i].get,set:d.DOMInterface[i].set})}d.redraw(e)},progresses:document.getElementsByTagName("progress")};for(var f=d.progresses.length-1;f>=0;f--){d.init(d.progresses[f])}if(document.addEventListener){document.addEventListener("DOMAttrModified",function(e){var k=e.target,i=e.attrName;if(/^progress$/i.test(k.nodeName)&&(i==="max"||i==="value")){d.redraw(k)}},false);document.addEventListener("DOMNodeInserted",function(e){var i=e.target;if(/^progress$/i.test(i.nodeName)){d.init(i)}},false)}})();(function(b){var a={};function c(f){var e=Object.prototype.toString.call(f);return f===null?"[object Null]":e===Object.prototype.toString.call(0)&&isNaN(f)?"[object NaN]":e}a.st=c("");a.ob=c({});a.fu=c(function(){});BVVIZ.getCurrentSite=function(){var e=window.document.getElementsByTagName("script"),h=e.length,g,f={};while(h--){if(e[h]["src"].match(/badgeville\.js/)){g=e[h]["src"];break}}if(c(g)===a.st){g.replace(/[\?&#]+([^\?=&#]+)=([^&#]*)/gi,function(i,l,j){j=j==="false"?false:j==="true"?true:j;f[l]=j});return f.sites_id||""}else{return""}};BVVIZ.currentSite=BVVIZ.getCurrentSite();BVVIZ.checkSiteStarted=false;BVVIZ.checkSiteTimeStarted=0;BVVIZ.checkSite=function(e){BVVIZ.checkSiteStarted=true;BVVIZ.checkSiteTimeStarted=new Date();BVSDK("sites",{sites:BVVIZ.currentSite},{fields:"cairo_viz"}).ok(function(f){BVVIZ.siteVizEnabled=false;if(BVVIZ.utility.validateNestedObj(f,"sites")){if(BVVIZ.currentSite===""){if(f.sites.length==1){BVVIZ.currentSite=f.sites[0].id}else{if(f.sites.length>1){BVVIZ.siteVizEnabled=true}}}b.each(f.sites,function(h,g){if(g.id===BVVIZ.currentSite){if(g.cairo_viz===true){BVVIZ.siteVizEnabled=true;if(c(e)===a.fu){e()}}else{if(typeof g.cairo_viz=="undefined"){BVVIZ.siteVizEnabled=true;if(c(e)===a.fu){e()}}}}})}}).fail(function(f){BVVIZ.siteVizEnabled=false}).always(function(f){if(typeof BVVIZ.siteVizEnabled==="undefined"){BVVIZ.siteVizEnabled=false}})};BVVIZ.waitForSiteCheck=function(e){if(!BVVIZ.checkSiteStarted){BVVIZ.checkSite()}if(c(e)===a.fu){if(typeof BVVIZ.siteVizEnabled!=="undefined"){if(BVVIZ.siteVizEnabled===true){e(true)}else{e(false)}}else{window.setTimeout(function(){if(new Date()-BVVIZ.checkSiteTimeStarted<5000){BVVIZ.waitForSiteCheck(e)}else{e(false)}},50)}}else{return false}};BVVIZ.config={playerOptions:{fields:"all",includes:["teams","rewards:currentlevels"]},contentOptions:{},activityOptions:{includes:["rewards","missionhistories","tracks"]}};var d={};BVVIZ.setPlayer=function(f,j){var i,h;function e(k){if(c(BVVIZ.notify)===a.fu){b.each(k.notifications,function(m,n){function l(){BVSDK("players/notifications",{players:BVVIZ.currentPlayer.id,notifications:n.id}).action("mark_read")}if(!n.read_at&&!d[n.id]){d[n.id]=true;switch(n.type){case"activities":BVVIZ.notify(n,"small",BVVIZ.currentPlayer.id,l);break;case"rewards":BVVIZ.notify(n,"medium",BVVIZ.currentPlayer.id,l);break;case"missions":case"tracks":BVVIZ.notify(n,"large",BVVIZ.currentPlayer.id,l);break}}else{if(!n.read_at){l()}}})}}function g(){var k=false;delete f.email;for(key in f){if(f[key]!==BVVIZ.currentPlayer[key]){k=true;break}}if(k){BVSDK("players",{players:BVVIZ.currentPlayer.id}).update(f,BVVIZ.config.playerOptions).always(function(l){if(l.errors){throw new Error("Badgeville: Error updating player ("+l.errors[0].message+")")}l.players[0].email=BVVIZ.currentPlayer.email;BVVIZ.currentPlayer=l.players[0];b(BVVIZ).trigger("player_update",{playerId:BVVIZ.currentPlayer.id});if(c(j)===a.fu){j(true,BVVIZ.currentPlayer)}})}else{if(c(j)===a.fu){j(false,BVVIZ.currentPlayer)}}}BVVIZ.waitForSiteCheck(function(k){if(k){if(!(c(f)===a.st&&f.indexOf("@")===-1)&&(c(f)!==a.ob||!f.email)){throw new Error('Badgeville: setPlayer requires either a player id or an object to be provided with at least a key of "email".')}if(BVVIZ.currentPlayer){if(BVVIZ.currentPlayer.email===f.email){g()}else{console.error("Badgeville: Player is already set.");if(c(j)===a.fu){j(false,BVVIZ.currentPlayer)}}}else{if(c(f)===a.st){f={email:f}}i=BVSDK("players",{players:f.email},BVVIZ.config.playerOptions);h=BVSDK("players").create(f,BVVIZ.config.playerOptions);BVSDK.all(i,h).ok(function(m,n){var l;if(m.players&&m.players.length>0){l=m.players[0]}else{if(n.players&&n.players.length>0){l=n.players[0]}}l.email=f.email;BVVIZ.currentPlayer=l;b(BVVIZ).bind("player_update",function(p,q){function o(r){b.each(BVVIZ.instances,function(t,s){if(r.playerId===s.playerId){if(s.needsPlayer){s.init(r.players[0])}else{s.init()}}})}if(BVVIZ.currentPlayer.id===q.playerId){if(BVVIZ.needsPlayer){BVSDK("players",{players:q.playerId},BVVIZ.config.playerOptions).ok(o)}}});BVSDK("players/notifications",{players:BVVIZ.currentPlayer.id},{fields:"all"}).subscribe(function(o){b(BVVIZ).trigger("player_update",{playerId:BVVIZ.currentPlayer.id});e(o)}).ok(e);g()}).fail(function(){console.error("Badgeville: Player can neither be found nor created.");if(c(j)===a.fu){j(false,BVVIZ.currentPlayer)}})}}})};BVVIZ.currentPlayer=false;BVVIZ.instances=BVVIZ.instances||[];BVVIZ.needsPlayer=false;BVVIZ.getContent=function(h){var f=BVVIZ.getContentData(),g,e;if(BVVIZ.content){if(c(h)===a.fu){h(BVVIZ.content)}return}if(f===false){BVVIZ.content=false;if(c(h)===a.fu){h(BVVIZ.content)}return}g=BVSDK("contents",null,b.extend({query:{url:f.url}},BVVIZ.config.contentOptions));e=BVSDK("contents").create(f,BVVIZ.config.contentOptions);BVSDK.all(g,e).ok(function(i,j){if(i.contents.length>0){BVVIZ.content=i.contents[0]}else{if(j.contents.length>0){BVVIZ.content=j.contents[0]}}if(c(h)===a.fu){h(BVVIZ.content)}}).fail(function(){BVVIZ.content=false;if(c(h)===a.fu){h(BVVIZ.content)}})};BVVIZ.getContentData=function(){function e(){var f=b('meta[name="og:url"], meta[property="og:url"]');if(f.length>0){return f.attr("content")}f=b('link[rel="canonical"]');if(f.length>0){return f.attr("href")}return window.location.href}return{url:encodeURIComponent(e()),title:encodeURIComponent(document.title)}};BVVIZ.content=false;BVVIZ.credit=function(e,f){if(c(BVVIZ.currentPlayer)===a.ob){if(c(e)===a.st&&e.length>0){e={verb:e}}if(c(e)===a.ob&&c(e.verb)===a.st&&e.verb.length>0){BVVIZ.getContent(function(g){if(c(g)===a.ob&&g.id){e.content_id=g.id}BVSDK("players/activities",{players:BVVIZ.currentPlayer.id}).create(e,BVVIZ.config.activityOptions).always(function(h){if(c(f)===a.fu){f.apply(this,arguments)}})})}else{throw new Error("Badgeville: BVVIZ.credit requires a verb (either as a string or an object property).")}}else{throw new Error("Badgeville: BVVIZ.credit called before BVVIZ.setPlayer is complete.")}};BVVIZ.creditOther=function(e,f,g){if(c(e)===a.st){if(c(f)===a.st&&f.length>0){f={verb:f}}if(c(f)===a.ob&&c(f.verb)===a.st&&f.verb.length>0){BVVIZ.getContent(function(h){if(c(h)===a.ob&&h.id){f.content_id=h.id}BVSDK("players/activities",{players:e}).create(f,BVVIZ.config.activityOptions).always(g)})}else{throw new Error("Badgeville: BVVIZ.creditOther requires a verb (either as a string or an object property).")}}else{throw new Error("Badgeville: BVVIZ.creditOther called without a player ID (or email) being provided.")}};BVVIZ.encryptEmail=function(j){if(c(CryptoJS)===a.ob){var m=j.split("@"),l=CryptoJS.MD5(m[0]).toString(CryptoJS.enc.Base64),k=CryptoJS.MD5(j).toString(CryptoJS.enc.Base64),g=l.substring(0,3),f=l.substring(3),h=g+k+f,i=(CryptoJS.SHA1(h)).toString(CryptoJS.enc.Base64),e=i+"@"+m[1];return e}else{throw new Error("Failed to encrypt email. CryptoJS library md5.js & sha1.js are NOT included.");return j}}})(jQuery);(function(a){BVVIZ.leaderboard=function(j,i,o){var h={},c={header:function(){return a('<div class="bvviz-header"><div class="bvviz-header-text">'+f.headerTitle+"</div></div>")},nav:function(p){var q=[],r;a.each(p,function(s,t){r=!t.display_name||t.display_name===""?t.name:t.display_name;q.push(a('<div class="bvviz-nav bvviz-'+s+'" title="'+r+'">'+r+"</div>").data("bvviz-lb-num",s))});q[q.length-1].addClass("bvviz-last");return q},card:function(r){var p=f.isHorizontal&&typeof r.display_name===typeof""?r.display_name.split(" ")[0]:r.display_name,q=a('<div class="bvviz-card">').append(a('<img class="bvviz-avatar" src="'+r.image+'" />'),a('<div class="bvviz-details"></div>').append(a('<div class="bvviz-name">'+p+"</div>"),a('<div class="bvviz-desc">'+r.value+" "+r.label+"</div>")),a('<div class="bvviz-rank">'+r.id+"</div>"));q.data("bvviz_type_id",r.type_id);return q},playerDrawer:function(p){var q=a('<div class="bvviz-drawer"><div class="bvviz-units"></div></div>');BVVIZ.helper.unitBar(a(".bvviz-units",q),p);if(a.isFunction(BVVIZ.playerProfile)){a('<div class="bvviz-view-player-profile">View Profile</div><div class="bvviz-clear"></div>').appendTo(q)}return q},teamDrawer:function(p){var q=a('<div class="bvviz-drawer"><div class="bvviz-units"></div></div>');BVVIZ.helper.unitBar(a(".bvviz-units",q),p);if(a.isFunction(BVVIZ.teamProfile)){a('<div class="bvviz-view-team-profile">View Profile</div><div class="bvviz-clear"></div>').appendTo(q)}return q}},d=[],b,m,f;o=a.isPlainObject(o)?o:{isHorizontal:o==="horizontal"};if(a.type(o.headerTitle)!=="string"||o.headerTitle==""){delete o.headerTitle}if(!a.isNumeric(o.pageSize)||o.pageSize<=0){delete o.pageSize}if(!a.isNumeric(o.showMeIndex)||o.showMeIndex<0){delete o.showMeIndex}if(!a.isNumeric(o.activeOnLoad)||o.activeOnLoad<0){delete o.activeOnLoad}f=a.extend({},BVVIZ.options.leaderboard,o);function n(){var q=[];function p(){var w,t,s=0,r=0,v=0,u=0;w=a('<div class="bvviz-body-header"></div>').append(c.nav(d));j.append(c.header(),a('<div class="bvviz-body bvviz-col"></div>').append(w));t=a(".bvviz-header",j);w.children(":visible").each(function(x,y){r+=a(y).outerHeight(true);v+=a(y).outerWidth(true);s++});t.children(":visible").each(function(x,y){u+=a(y).outerHeight()});t.children().css("margin-top",(t.height()-u)/2);w.css("padding-top",(w.height()-r)/2);if(v<w.width()){w.width(v+w.outerWidth()-w.width()+0.5)}else{w.children(":visible").each(function(x,y){a(y).outerWidth(w.width()/s)})}k(f.activeOnLoad)}j=a(j);if(j.length>1){return BVVIZ.helper.showError(j,'"target" argument must reference a single DOM node.')}if(!a.isArray(i)||i.length<=0){return BVVIZ.helper.showError(j,'"leaderboardIds" argument must be an array with at least one value.')}j.empty().addClass(f.isHorizontal?"bvviz bvviz-leaderboard bvviz-horizontal":"bvviz bvviz-leaderboard");b=null;if(d.length>0){p();return}a.each(i,function(r,s){q.push(BVSDK("leaderboards",{leaderboards:s}))});BVSDK.when.apply(BVSDK,q).ok(function(){d=jQuery.map(arguments,function(s,r){return s.leaderboards[0]});p()}).fail(function(r){BVVIZ.helper.showError(j,r)});j.bind("click",function(t){var u=a(t.target),r,s;if(u.hasClass("bvviz-nav")){k(u.data("bvviz-lb-num"));t.preventDefault();return false}r=u.closest(".bvviz-card");if(a.isFunction(BVVIZ.playerProfile)&&r.length&&!r.hasClass("bvviz-team")){BVVIZ.helper.showModal(BVVIZ.playerProfile,[r.data("bvviz_type_id")]);t.preventDefault();return false}if(a.isFunction(BVVIZ.teamProfile)&&r.length&&r.hasClass("bvviz-team")){BVVIZ.helper.showModal(BVVIZ.teamProfile,[r.data("bvviz_type_id")]);t.preventDefault();return false}if(a.isFunction(BVVIZ.playerProfile)&&u.hasClass("bvviz-view-player-profile")){BVVIZ.helper.showModal(BVVIZ.playerProfile,[r.data("bvviz_type_id")]);t.preventDefault();return false}if(a.isFunction(BVVIZ.teamProfile)&&u.hasClass("bvviz-view-team-profile")){BVVIZ.helper.showModal(BVVIZ.teamProfile,[r.data("bvviz_type_id")]);t.preventDefault();return false}t.preventDefault();return false})}function k(q){var r=a(m),s=a('<div class="bvviz-cards bvviz-col bvviz-leaderboard-cards" style="display:none;"></div>'),p=a(".bvviz-nav.bvviz-"+q,j);if(b===q){f.loadLBToggle=!f.loadLBToggle}else{f.loadLBToggle=f.loadRelative}j.hasClass("bvviz-horizontal")&&a(".bvviz-scrollable-wrapper").remove();p.siblings().removeClass("bvviz-active");p.addClass("bvviz-active");if(f.isHorizontal){a("<div/>").addClass("bvviz-scrollable-wrapper").appendTo(a(".bvviz-body",j)).append(s)}else{a(".bvviz-body",j).append(s)}m=s;b=q;s.fadeIn(null,function(){r.unbind("scroll.bvviz");r.remove();if(f.isHorizontal){BVVIZ.helper.infiniteLeftRightScroll(s,h)}else{BVVIZ.helper.infiniteUpDownScroll(s,h)}BVVIZ.helper.customLoadPrevious(s,h);BVVIZ.helper.customLoadNext(s,h);s.data("bvviz-pagesize",f.pageSize);if(f.loadLBToggle&&BVVIZ.currentPlayer&&BVVIZ.currentPlayer.id){BVSDK("players/positions",{players:BVVIZ.currentPlayer.id,positions:i[b]},{fields:"all"}).ok(function(u){var v=u.positions&&u.positions[0]&&a.isNumeric(u.positions[0].rank)?parseInt(u.positions[0].rank,10)-1:-1;if(v-f.showMeIndex>0){s.data("bvviz-offset-start",v-f.showMeIndex);s.data("bvviz-offset-end",v-f.showMeIndex+f.pageSize);l(v-f.showMeIndex,"initial")}else{t()}}).fail(function(u){t()})}else{t()}function t(){s.data("bvviz-offset-start",0);s.data("bvviz-offset-end",f.pageSize);l(0,"initial")}})}function l(s,q){var u,p=f.pageSize,t,r;if(s<0){p=f.pageSize+s;s=0}if(p===0){return}u=BVVIZ.helper.loading("bvviz-tr"),j.append(u);BVSDK("leaderboards/ranks",{leaderboards:i[b]},{offset:s,limit:p,fields:"all"}).ok(function(A){var B=a(".bvviz-card:first",m),E=a(".bvviz-card:last",m),y=a(".bvviz-show-scroll.bvviz-previous",m),z=a(".bvviz-show-scroll.bvviz-next",m),v="",C=a(),w=0;u.remove();if(q==="previous"){y.remove();v=B.hasClass("bvviz-odd")&&(p%2===0)?"bvviz-odd":"bvviz-even"}else{if(q==="next"){z.remove();v=E.hasClass("bvviz-odd")?"bvviz-even":"bvviz-odd"}else{y.remove();z.remove();v=E.hasClass("bvviz-odd")?"bvviz-even":"bvviz-odd"}}a.each(A.ranks,function(F,G){if(BVVIZ.currentPlayer&&(G.type_id===BVVIZ.currentPlayer.id||G.email===BVVIZ.currentPlayer.email)){v+=" bvviz-self"}if(G.type==="teams"){v+=" bvviz-team"}C=C.add(c.card(G).addClass("bvviz-invisible "+v));v=v.indexOf("bvviz-odd")>=0?"bvviz-even":"bvviz-odd"});if(q==="previous"){m.prepend(C)}else{m.append(C)}t=m.data("bvviz-offset-start")<s?m.data("bvviz-offset-start"):s;r=m.data("bvviz-offset-end")>s+p?m.data("bvviz-offset-end"):s+p;m.data("bvviz-offset-start",t);m.data("bvviz-offset-end",r);if(f.isHorizontal){BVVIZ.helper.fitWidth(j)}else{BVVIZ.helper.fitHeight(j)}BVVIZ.helper.showCards(m);if(q==="previous"){if(s>0){x()}else{m.unbind("load-previous.bvviz")}}else{if(q==="next"){if(A.ranks.length<f.pageSize){m.unbind("load-next.bvviz")}else{D()}}else{if(A.ranks.length<f.pageSize){m.unbind("load-next.bvviz");m.children().each(function(){if(f.isHorizontal){w+=a(this).outerWidth(true)}else{w+=a(this).outerHeight(true)}});if(f.isHorizontal){a("<div>").width(m[0].scrollWidth-w).appendTo(m)}else{a("<div>").height(m[0].scrollHeight-w).appendTo(m)}}else{D()}if(s>0){x()}else{m.unbind("load-previous.bvviz")}}}function x(){var F=a('<div class="bvviz-show-scroll bvviz-previous">More &rsaquo;</div>').prependTo(m).bind("click",function(){a(m).trigger("scroll.bvviz")});var G=a(m).parent().width();if(f.isHorizontal){a(m).width(a(m).width()+a(".bvviz-show-scroll",m).width()).parent().width(G).scrollLeft(F.width())}else{m.scrollTop(F.height())}}function D(){a('<div class="bvviz-show-scroll bvviz-next">More &rsaquo;</div>').appendTo(m).bind("click",function(){a(m).trigger("scroll.bvviz")});if(f.isHorizontal){a(m).width(a(m).width()+a(".bvviz-show-scroll",m).width())}}}).fail(function(x){var w=a(".bvviz-show-scroll.bvviz-previous",m),v=a(".bvviz-show-scroll.bvviz-next",m);u.remove();if(q==="previous"){m.unbind("load-previous.bvviz");w.remove()}else{if(q==="next"){m.unbind("load-next.bvviz");a(".bvviz-show-scroll.bvviz-next",m).css("visibility","hidden")}else{m.unbind("scroll.bvviz");m.unbind("load-previous.bvviz");m.unbind("load-next.bvviz");w.remove();v.remove()}}})}function e(p){p.append(BVVIZ.helper.loading());BVSDK("players",{players:p.data("bvviz_type_id")},{fields:"all",includes:"teams,rewards:currentlevels"}).ok(function(q){a(".bvviz-loading",p).remove();c.playerDrawer(q.players[0]).appendTo(p).slideToggle()}).fail(function(q){BVVIZ.helper.showError(j,q)})}function g(p){p.append(BVVIZ.helper.loading());BVSDK("teams",{teams:p.data("bvviz_type_id")},{fields:"all"}).ok(function(q){a(".bvviz-loading",p).remove();c.teamDrawer(q.teams[0]).appendTo(p).slideToggle()}).fail(function(q){BVVIZ.helper.showError(j,q)})}BVVIZ.waitForSiteCheck(function(p){if(p){n()}else{return false}});h.init=n;h.show=k;h.load=l;return h}})(jQuery);(function(a){BVVIZ.levelProgress=function(g,d,b,c){var f={},e={card:function(j,r,k){var l=a('<span class="bvviz-card bvviz-invisible bvviz-level"></span>'),i=j&&j.player_criteria[0]&&j.player_criteria[0].value,m=r&&r.player_criteria[0]&&r.player_criteria[0].value,n,p,q,o;if(!a.isPlainObject(j)){n=1;p=0;q=0;o="Not started yet"}else{if(!a.isPlainObject(r)){n=1;p=1;q=100;o="Completed"}else{n=1;if(r.player_criteria[0]&&k==r.player_criteria[0].value){p=0;j=r}else{if(j.player_criteria[0]&&r.player_criteria[0]&&(r.player_criteria[0].value-j.player_criteria[0].value!=0)){p=(k-j.player_criteria[0].value)/(r.player_criteria[0].value-j.player_criteria[0].value)}else{p=1}}q=Math.floor(p*100);o=q+"%"}}if(BVVIZ.utility.isIe8OrLess()){l.append(a('<div class="bvviz-label bvviz-line">'+j.name+"</div>"),a('<div class="bvviz-progress bvviz-line"></div>').append(a('<div class="bvviz-progress-bar"></div>'),a('<span class="bvviz-progress-label">'+o+"</span>")),a('<img class="bvviz-level-icon bvviz-current" src="'+j.image+'">'))}else{l.append(a('<div class="bvviz-label bvviz-line">'+j.name+"</div>"),a('<div class="bvviz-progress bvviz-line"></div>').append(a('<progress class="bvviz-progress-bar" max="'+n+'" value="'+p+'"></progress>'),a('<span class="bvviz-progress-label">'+o+"</span>")),a('<img class="bvviz-level-icon bvviz-current" src="'+j.image+'">'));if(q<30){l.find(".bvviz-progress-label").css("left",q+5+"%").addClass("bvviz-backlabel")}else{if(q<100){l.find(".bvviz-progress-label").css("left",q-22+"%").addClass("bvviz-forelabel")}else{l.find(".bvviz-progress-label").css("left",5+"%").addClass("bvviz-forelabel")}}}return l}};function h(){g=a(g);if(g.length>1){return BVVIZ.helper.showError(g,'"target" argument must reference a single DOM node.')}if(a.type(d)!=="string"){return BVVIZ.helper.showError(g,'"player" argument must be a player id.')}g.empty().addClass("bvviz bvviz-levelProgress");BVSDK("players",{players:d},{includes:"rewards:currentlevels"}).ok(function(k){if(k&&k.players&&k.players[0]){var j=k.players[0].units,l=k.players[0].units.points.all,i=0;a.each(k.players,function(n,m){if(m["rewards:currentlevels"].length>0){a.each(m["rewards:currentlevels"],function(o,p){if(p.mission_id==b){i=parseInt(p.mission_position-1,10)||0;BVSDK("missions/rewards",{missions:b},{offset:parseInt(p.mission_position-1,10),fields:"player_criteria",limit:2}).ok(function(q){var t=[],s=BVVIZ.utility.validateNestedObj(q,"rewards",[0],"player_criteria",[0])?q.rewards[0].player_criteria[0]:null;try{if(a.isPlainObject(s)){t=a.type(s.field)==="string"?String.prototype.split.call(s.field,"."):[];if(t.length===3){t[1]=t[1]==="points"?t[1]:"unit_"+t[1];l=j[t[1]][t[2]]}if(q.rewards.length==2){g.append(e.card(q.rewards[0],q.rewards[1],l))}else{g.append(e.card(q.rewards[0],null,l))}}if(a.isFunction(BVVIZ.missionProgress)){a(".bvviz-level-icon",g).click(function(u){BVVIZ.helper.showModal(BVVIZ.missionProgress,[d,b]);u.preventDefault();return false})}BVVIZ.helper.showCards(g)}catch(r){return false}}).fail(function(q){g.append(e.card(null,null,l))})}})}})}}).fail(function(i){BVVIZ.helper.showError(g,i)})}BVVIZ.waitForSiteCheck(function(i){if(i){h()}else{return false}});f.init=h;f.playerId=d;BVVIZ.instances=BVVIZ.instances||[];BVVIZ.instances.push(f);return f}})(jQuery);(function(a){BVVIZ.missionProgress=function(j,h,c,m){var i={},e={header:function(n){return a('<div class="bvviz-header"><div class="bvviz-header-text">'+(g.headerTitle?g.headerTitle:n)+"</div></div>")},bodyHeader:function(n){return a('<div class="bvviz-body-header"><div class="bvviz-percent">'+(n.progress.percent?n.progress.percent:0)+'%</div><div class="bvviz-hint">'+n.hint+"</div></div>")},card:function(p,n){var o=a('<div class="bvviz-card bvviz-invisible"></div>').append(a('<div class="bvviz-picture-container"></div>').append(a('<img class="bvviz-picture" src="'+p.image+'"/>'),a('<div class="bvviz-bridge"></div>')),a('<div class="bvviz-details"></div>').append(a('<div class="bvviz-name">'+p.name+"</div>"),a('<div class="bvviz-desc">'+(p.hint?p.hint:"")+"</div>")));if(!n){o.addClass("bvviz-grey")}o.data("bvviz-reward",p.definition_id);return o}},b="bvviz-odd",d=false,f=true,g;m=a.isPlainObject(m)?m:{inline:!!m};if(m.childContentCards){m.inline=true}if(a.type(m.headerTitle)!=="string"||m.headerTitle==""){delete m.headerTitle}if(!a.isNumeric(m.pageSize)||m.pageSize<0||m.pageSize>BVVIZ.options.missionProgress.maxPageSize){delete m.pageSize}g=a.extend({},BVVIZ.options.missionProgress,m);function l(){var n=BVVIZ.helper.loading("bvviz-tr");j=a(j);if(j.length>1){return BVVIZ.helper.showError(j,'"target" argument must reference a single DOM node.')}if(typeof(h)!=="string"||h.length<=0){return BVVIZ.helper.showError(j,'"playerId" argument must be a string.')}if(typeof(c)!=="string"||c.length<=0){return BVVIZ.helper.showError(j,'"missionId" argument must be a string.')}j.empty().addClass("bvviz bvviz-missionProgress").append(a('<div class="bvviz-body bvviz-col"><div class="bvviz-cards bvviz-col"></div></div>'),n);BVSDK.all(BVSDK("missions",{missions:c},{fields:"hint"}),BVSDK("players/missions",{players:h,missions:c},{fields:"hint"})).ok(function(o,q){var p=a(".bvviz-cards",j);if(!g.inline){e.header(o.missions[0].name).prependTo(j)}if(q&&a.isArray(q.missions)){e.bodyHeader(q.missions[0]).prependTo(a(".bvviz-body",j));d=true}else{e.bodyHeader(o.missions[0]).prependTo(a(".bvviz-body",j))}n.remove();BVVIZ.helper.fitHeight(j);BVVIZ.helper.infiniteScroll(p,i);if(o.missions[0].type=="random"||o.missions[0].type=="unordered"){f=false}k(0);if(a.isFunction(BVVIZ.rewardProgress)){p.bind("click",function(s){var t=a(s.target),r=t.closest(".bvviz-card"),u;if(r.length>0){u=r.data("bvviz-reward");BVVIZ.helper.showModal(BVVIZ.rewardProgress,[h,u]);s.preventDefault();return false}})}}).fail(function(o){n.remove();BVVIZ.helper.showError(j,o)})}function k(p){var q=a(".bvviz-cards",j),n=g.pageSize===0?g.maxPageSize:g.pageSize,r=BVVIZ.helper.loading("bvviz-tr");function o(t,s){var u={};if(s){a.each(s.rewards,function(v,w){u[w.definition_id]=true})}a.each(t.rewards,function(v,w){q.append(e.card(w,u[w.id]).addClass(b));b=b==="bvviz-odd"?"bvviz-even":"bvviz-odd"});if(f===false){a(".bvviz-bridge",q).remove()}if(p===0){if(f){a(".bvviz-bridge:first",q).remove()}a(".bvviz-card:first",q).addClass("bvviz-first")}r.remove();BVVIZ.helper.showCards(q)}j.append(r);BVSDK("missions/rewards",{missions:c},{fields:"hint",offset:p*n,limit:n}).ok(function(s){if(d){BVSDK("players/missions/rewards",{players:h,missions:c},{fields:"hint",query:{definition_id:a.map(s.rewards,function(t){return t.id})}}).ok(function(t){o(s,t)})}else{o(s)}if(s.rewards.length<n){q.unbind("scroll.bvviz")}else{BVVIZ.helper.loadNextPage(q,i)}}).fail(function(){q.unbind("scroll.bvviz");r.remove()})}BVVIZ.waitForSiteCheck(function(n){if(n){l()}else{return false}});i.init=l;i.load=k;i.playerId=h;BVVIZ.instances=BVVIZ.instances||[];BVVIZ.instances.push(i);return i}})(jQuery);(function(a){BVVIZ.missionRewards=function(g,e,b,j){var f={},c={header:function(k){return a('<div class="bvviz-header"><div class="bvviz-header-text">'+(d.headerTitle?d.headerTitle:k)+"</div></div>")},body:function(){var k=a('<div class="bvviz-body"></div>').append(c.description());if(!d.showContainerFrame){k.addClass("bvviz-noframe")}if(d.inline){k.addClass("bvviz-noheader")}return k},description:function(){var k=d.description?a('<div class="bvviz-body-title">'+d.description+"</div>"):"";if(d.description&&d.descriptionFontColor){k.css("color",d.descriptionFontColor)}return k},card:function(m){var l=!!(BVVIZ.utility.validateNestedObj(m,"image")&&m.image),n=l?m.image:BVVIZ.helper.imageHolderSrc();n=!m.earned_by&&d.badges.lockUnearned?BVVIZ.helper.imageHolderSrc():n;var k=a('<div class="bvviz-card bvviz-invisible"></div>');if(d.badges.miniBadge){k.addClass("bvviz-mini").append(a('<img class="bvviz-picture'+(l?"":" bvviz-broken")+'" src="'+n+'" />'),(d.badges.showName?a('<div class="bvviz-name" title="'+m.name+'">'+m.name+"</div>"):""),(d.badges.showProgress?c.progress(m):""),c.count(m))}else{k.append(a('<img class="bvviz-picture'+(l?"":" bvviz-broken")+'" src="'+n+'" />'),(d.badges.showName?a('<div class="bvviz-name" title="'+m.name+'">'+m.name+"</div>"):""),(d.badges.showProgress?c.progress(m):""))}if(!m.earned_by){k.addClass("bvviz-grey");if(d.badges.lockUnearned){k.addClass("bvviz-locked")}}if(d.badges.miniBadge||!d.badges.showBadgeBorder){k.addClass("bvviz-borderless")}if(d.badges.badgeBackgroundColor){k.css("background-color",d.badges.badgeBackgroundColor)}if(d.badges.badgeFontColor){k.css("color",d.badges.badgeFontColor)}if(d.badges.miniBadge){k.addClass("bvviz-mini")}k.data("bvviz-reward",m.definition_id);return k},progress:function(m){var l=m.progress,k=a('<div class="bvviz-progress"></div>');if(a.isNumeric(m.earned_total_count)){if(d.badges.miniBadge&&BVVIZ.utility.isIe8OrLess()){k.html("&#10003;")}else{if(d.badges.miniBadge){k.html(BVVIZ.helper.svgCheckmarkMini())}else{if(BVVIZ.utility.isIe8OrLess()){k.html("Completed").append(a('<div class="bvviz-checkmark-corner bvviz-nosvg"></div>'))}else{k.html("Completed").append(a('<div class="bvviz-checkmark-corner">'+BVVIZ.helper.svgCheckmarkCorner()+"</div>"))}}}}else{if(a.isPlainObject(l)){k.html(l.earned+"/"+l.possible)}}return k},count:function(k){return k.earned_total_count?a('<div class="bvviz-count">'+k.earned_total_count+"x</div>"):""},dialog:function(k){return a('<div class="bvviz bvviz-missionRewards bvviz-dialog"><div class="bvviz-name">'+k.name+'</div><div class="bvviz-desc">'+k.hint+"</div></div>")}},d;j=a.isPlainObject(j)?j:{inline:!!j};if(!j.showContainerFrame||j.childContentCards){j.inline=true}if(a.type(j.headerTitle)!=="string"||j.headerTitle==""){delete j.headerTitle}if(!j.showDescription||a.type(j.description)!=="string"||j.description==""){delete j.description}if(a.type(j.descriptionFontColor)!=="string"||!j.descriptionFontColor.match(/^(#[0-9A-Fa-f]{3,6})|(\w)$/)){delete j.descriptionFontColor}if(!a.isNumeric(j.pageSize)||j.pageSize<0||j.pageSize>BVVIZ.options.missionRewards.maxPageSize){delete j.pageSize}if(BVVIZ.utility.validateNestedObj(j,"badges")){if(a.type(j.badges.badgeBackgroundColor)!=="string"||!j.badges.badgeBackgroundColor.match(/^(#[0-9A-Fa-f]{3,6})|(\w)$/)){delete j.badges.badgeBackgroundColor}if(a.type(j.badges.badgeFontColor)!=="string"||!j.badges.badgeFontColor.match(/^(#[0-9A-Fa-f]{3,6})|(\w)$/)){delete j.badges.badgeFontColor}}d=a.extend({},BVVIZ.options.missionRewards,j);function i(){var k=a('<div class="bvviz-cards bvviz-row"></div>');g=a(g);if(g.length>1){return BVVIZ.helper.showError(g,'"target" argument must reference a single DOM node.')}if(typeof(e)!=="string"||e.length<=0){return BVVIZ.helper.showError(g,'"playerId" argument must be a string.')}g.empty().addClass("bvviz bvviz-missionRewards").append((d.childContentCards?k:c.body().append(k)));BVSDK("missions",{missions:b}).ok(function(l){if(!d.inline){c.header(l.missions[0].name).prependTo(g)}BVVIZ.helper.fitHeight(g);if(d.pageSize!==0){BVVIZ.helper.infiniteScroll(k,f)}h(0)}).fail(function(l){BVVIZ.helper.showError(g,l)});if(a.isFunction(BVVIZ.rewardProgress)){k.bind("click",function(m){var n=a(m.target),l=n.closest(".bvviz-card"),o;if(l.length>0){o=l.data("bvviz-reward");BVVIZ.helper.showModal(BVVIZ.rewardProgress,[e,o]);m.preventDefault();return false}})}}function h(l){var n=BVVIZ.helper.loading("bvviz-tr"),m=a(".bvviz-cards",g),k=d.pageSize===0?d.maxPageSize:d.pageSize;if(!d.childContentCards){g.append(n)}BVSDK("missions/rewards",{missions:b},{fields:"hint",offset:l*k,limit:k,query:({active:true})}).ok(function(p){var o=a.map(p.rewards,function(q){return q.id});if(p.rewards.length>0){if(a.isFunction(d.beforeRequestCallback)){d.beforeRequestCallback()}BVSDK.all(BVSDK("players/progresses",{players:e},{query:{type:"all_rewards",definition_id:o}}),BVSDK("players/missions/rewards",{players:e,missions:b},{fields:["earned_total_count"],query:{definition_id:o}})).ok(function(q,r){var t={},s;if(r&&r.rewards){a.each(r.rewards,function(u,w){t[w.definition_id]=w;try{a.each(q.progresses,function(y,x){if(w.definition_id==x.definition_id){t[w.definition_id].progress=x}})}catch(v){}})}a.each(p.rewards,function(u,v){try{a.each(q.progresses,function(y,x){if(v.id==x.definition_id){v.progress=x}})}catch(w){}if(d.badges.showUnearned){m.append(c.card(t[v.id]?t[v.id]:v))}else{if(t[v.id]){m.append(c.card(t[v.id]))}}});if(!d.childContentCards){if(!s){s=BVVIZ.helper.fitRowCardWidth(m.children(":first"),m)}m.children().width(s);n.remove();BVVIZ.helper.showCards(m)}}).always(function(){if(a.isFunction(d.callback)){d.callback()}})}else{n.remove()}if(p.rewards.length<k){m.unbind("scroll.bvviz")}else{BVVIZ.helper.loadNextPage(m,f)}}).fail(function(){m.unbind("scroll.bvviz");n.remove()})}BVVIZ.waitForSiteCheck(function(k){if(k){i()}else{return false}});f.init=i;f.load=h;f.playerId=e;BVVIZ.instances=BVVIZ.instances||[];BVVIZ.instances.push(f);return f}})(jQuery);(function(a){BVVIZ.missionTutorial=function(h,f,c,i){var g={},e={header:function(m){return a('<div class="bvviz-header"><div class="bvviz-header-text">'+m+"</div></div>")},bodyHeader:function(m){return a('<div class="bvviz-body-header"></div>').append(a("<div></div>").progressbar({value:m.progress.percent}).prepend(a('<div class="bvviz-percent">'+(m.progress.percent?m.progress.percent:0)+"%</div>")))},card:function(o,m){var n=a('<div class="bvviz-card bvviz-invisible '+(m?"bvviz-complete":"bvviz-not-started")+'" data-bvviz-reward_id="'+o.id+'"></div>').append(this.checkmark(),a('<div class="bvviz-details"></div>').append('<div class="bvviz-name">'+o.name+"</div>",a('<div class="bvviz-desc"></div>').append(this.unknownProgress(o,m))));if(o.hint&&o.hint.length>0){n.append(this.knobs(),'<div class="bvviz-drawer"><div>'+o.hint+"</div></div>")}return n},checkmark:function(){if(BVVIZ.utility.isIe8OrLess()){return a('<div class="bvviz-checkmark"><div class="bvviz-checkmark-underlay"></div><div class="bvviz-checkmark-overlay bvviz-mid"></div><div class="bvviz-checkmark-overlay bvviz-left"></div><div class="bvviz-checkmark-overlay bvviz-right"></div></div>')}else{return a('<div class="bvviz-checkmark-circle">'+BVVIZ.helper.svgCheckmarkCircle()+"</div>")}},knobs:function(){return a('<div class="bvviz-knobs"><div class="bvviz-knob"></div><div class="bvviz-knob"></div><div class="bvviz-knob"></div></div>')},unknownProgress:function(n,m){if(m){if(n.progress_possible){return"Completed ("+n.progress_possible+"/"+n.progress_possible+")"}return"Completed"}if(n.progress_possible){return"Not Started (0/"+n.progress_possible+")"}return"&nbsp;"},progress:function(n,m){var o=n.find(".bvviz-desc");if(m.percent==0){o.html("Not Started")}else{if(m.percent<100){o.html("In Progress ("+m.earned+"/"+m.possible+")");n.removeClass("bvviz-not-started").addClass("bvviz-started")}else{o.html("Completed ("+m.earned+"/"+m.possible+")")}}}},b="bvviz-odd",j=10,d=false;function l(){var m=BVVIZ.helper.loading("bvviz-tr");h=a(h);if(h.length>1){return BVVIZ.helper.showError(h,'"target" argument must reference a single DOM node.')}if(typeof(f)!=="string"||f.length<=0){return BVVIZ.helper.showError(h,'"playerId" argument must be a string.')}if(typeof(c)!=="string"||c.length<=0){return BVVIZ.helper.showError(h,'"missionId" argument must be a string.')}h.empty().addClass("bvviz bvviz-missionTutorial").append(a('<div class="bvviz-body bvviz-col"><div class="bvviz-cards bvviz-col"></div></div>'),m);h.bind("click",function(o){var p=a(o.target),n=p.closest(".bvviz-card");if(!n.length){return}a(".bvviz-drawer",n).stop().slideToggle()});BVSDK.all(BVSDK("missions",{missions:c}),BVSDK("players/missions",{players:f,missions:c})).ok(function(o,p){var n=a(".bvviz-body",h);if(i){n.addClass("bvviz-noheader")}else{e.header(o.missions[0].name).prependTo(h)}if(p&&a.isArray(p.missions)){e.bodyHeader(p.missions[0]).prependTo(n);d=true}else{e.bodyHeader(o.missions[0]).prependTo(n)}m.remove();BVVIZ.helper.fitHeight(h);BVVIZ.helper.infiniteScroll(a(".bvviz-cards",h),g);k(0)}).fail(function(n){m.remove();BVVIZ.helper.showError(h,n)})}function k(n){var o=a(".bvviz-cards",h),p=BVVIZ.helper.loading("bvviz-tr");function m(r,q){var t={},s=[],u={};if(q){a.each(q.rewards,function(v,w){t[w.definition_id]=true})}a.each(r.rewards,function(v,w){if(!t[w.id]){s.push(w.id)}o.append(e.card(w,t[w.id]).addClass(b));b=b==="bvviz-odd"?"bvviz-even":"bvviz-odd"});if(s.length>0){BVSDK("players/progresses",{players:f},{query:{type:"all_rewards",definition_id:s}}).ok(function(v){a.each(v.progresses,function(x,w){e.progress(o.find('[data-bvviz-reward_id="'+w.definition_id+'"]'),w)})})}p.remove();BVVIZ.helper.showCards(o)}h.append(p);BVSDK("missions/rewards",{missions:c},{fields:["hint","progress_possible"],offset:n*j,limit:j}).ok(function(q){if(d){BVSDK("players/missions/rewards",{players:f,missions:c},{fields:"hint",query:{definition_id:a.map(q.rewards,function(r){return r.id})}}).ok(function(r){m(q,r)})}else{m(q)}if(q.rewards.length<j){o.unbind("scroll.bvviz")}}).fail(function(){o.unbind("scroll.bvviz");p.remove()})}BVVIZ.waitForSiteCheck(function(m){if(m){l()}else{return false}});g.init=l;g.load=k;g.playerId=f;BVVIZ.instances=BVVIZ.instances||[];BVVIZ.instances.push(g);return g}})(jQuery);(function(a){BVVIZ.queue=BVVIZ.queue||{};BVVIZ.queue.notify=BVVIZ.queue.notify||[];BVVIZ.notify=function(b,j,r,e){var m={},u=a('<div class="bvviz bvviz-notify bvviz-'+j+'" id="bvviz-notify-'+j+'"></div>'),v={small:function(w){var x=BVVIZ.utility.validateNestedObj(w,"image")&&w.image?w.image:BVVIZ.helper.imageHolderSrc();u.addClass("bvviz-background");if(x.match(/^[\w\s]+$/)){return a('<span class="bvviz-picture"><span class="bvviz-sprite-icon '+x+'"></span></span><div class="bvviz-details">'+(w.message?w.message:w.name)+"</div>").add(this.units(w.units))}else{if(x.indexOf("http")>-1){return a('<img class="bvviz-picture" src="'+x+'" /><div class="bvviz-details">'+(w.message?w.message:w.name)+"</div>").add(this.units(w.units))}}return a('<div class="bvviz-details">'+(w.message?w.message:w.name)+"</div>").add(this.units(w.units))},medium:function(x){var w=a('<div class="bvviz-card bvviz-background"><div class="bvviz-details"><div class="bvviz-name">'+x.name+'</div><div class="bvviz-desc">'+x.message+"</div></div></div>").prepend(this.units(x.units));if(r&&a.isFunction(BVVIZ.playerProfile)){w.prepend(a('<div class="bvviz-view-player-profile bvviz-inverted">View Profile</div>').bind("click",function(){BVVIZ.helper.showModal(BVVIZ.playerProfile,[r])}))}return w},mediumContainer:function(w){var x=BVVIZ.utility.validateNestedObj(w,"image")&&w.image?w.image:BVVIZ.helper.imageHolderSrc();return a('<div class="bvviz-container"><img class="bvviz-rays" src="'+BVVIZ.helper.imageHolderSrc()+'" /><img class="bvviz-picture" src="'+x+'" /><div class="bvviz-body bvviz-col"><div class="bvviz-cards bvviz-col"></div></div></div>')},large:function(x){var y=BVVIZ.utility.validateNestedObj(x,"image")&&x.image?x.image:BVVIZ.helper.imageHolderSrc();var w=a('<div class="bvviz-container"></div>').append(a('<div class="bvviz-close">x</div>').bind("click",g),'<img class="bvviz-picture" src="'+y+'" /><div class="bvviz-details"><div class="bvviz-name">'+x.name+'</div><div class="bvviz-desc">'+x.message+"</div></div>",this.units(x.units));if(r&&a.isFunction(BVVIZ.playerProfile)){w.append(a('<div class="bvviz-view-player-profile bvviz-inverted">View Profile</div>').bind("click",function(){BVVIZ.helper.showModal(BVVIZ.playerProfile,[r])}))}return w},units:function(w){var x=a('<div class="bvviz-units"></div>');if(!w){return x}a.each(w,function(y,z){if(!z.earned&&z.possible){z.earned=z.possible}if(z.earned&&z.earned!==0){x.append('<div class="bvviz-unit">'+(z.earned>0?"+":"")+z.earned+" "+z.display_name+"</div>")}});return x}},h;function q(){if(typeof(b)!="object"){return}switch(j){case"small":c();break;case"large":t();break;default:l()}}function p(){return{name:b.name||(b.data&&b.data.name)||(b.behaviors&&b.behaviors.length>0?b.behaviors[0].name:null),message:b.message||"",image:b.image||(b.data&&b.data.image)||(b.behaviors&&b.behaviors.length>0?b.behaviors[0].image:null),units:b.units}}function o(C,x){var y=x,w,B;function A(){window.clearTimeout(w);y-=new Date()-B}function z(){B=new Date();w=window.setTimeout(C,y)}z();return{pause:A,resume:z}}function s(x,w){h=new o(x,w*1000)}function f(){if(h){h.pause()}}function d(){if(h){h.resume()}}function k(){u.remove();f();try{e(b,j,r)}catch(w){}if(BVVIZ.queue.notify.length>0){a.each(BVVIZ.queue.notify,function(x,y){if(y[1]===j){BVVIZ.notify.apply(BVVIZ,BVVIZ.queue.notify.splice(x,1)[0]);return false}})}}function c(){var x=p(),w;if(!x.name){return}u.append(v.small(x));u.appendTo("body");w=u.width();u.css({right:w*-1}).animate({right:"+="+(w+20)},null,function(){s(i,3)}).bind("click",i).bind("mouseenter",f).bind("mouseleave",d)}function i(){u.stop().animate({right:"-="+(u.width()+20)},k)}function l(){var x=p(),w=v.mediumContainer(x);if(!x.name){return}w.find(".bvviz-cards").append(v.medium(x));u.append(w).appendTo("body").slideToggle(function(){w.prepend(a('<div class="bvviz-close">x</div>').bind("click",n));s(n,5)}).bind("mouseenter",f).bind("mouseleave",d)}function n(){u.find(".bvviz-close").unbind("click").remove();u.stop().slideToggle({complete:k})}function t(){var y=p();if(!y.name){return}var x=v.large(y).bind("mouseenter",f).bind("mouseleave",d),w=0;u.append(x).appendTo("body");w=u.height();u.css({top:-w}).animate({top:"+="+(w+100)},null,function(){s(g,5)})}function g(){u.find(".bvviz-close").unbind("click");u.stop().animate({top:"-"+u.height()},k)}j=j&&j.length>0?j.toLowerCase():"medium";if(a("#bvviz-notify-"+j).length>0){BVVIZ.queue.notify.push(Array.prototype.slice.call(arguments))}else{BVVIZ.waitForSiteCheck(function(w){if(w){q()}else{return false}});if(b&&b.verb&&b.behaviors&&b.behaviors.length>1){a.each(b.behaviors,function(x,y){var w=a.extend({},b);if(x===0){return}w.behaviors=[y];BVVIZ.notify(w,j,r)});b.behaviors=b.behaviors.slice(0,1)}}switch(j){case"small":m.hide=i;break;case"large":m.hide=g;break;default:m.hide=n}return m}})(jQuery);(function(a){BVVIZ.playerCard=function(g,i,l){var f={},b={header:function(){return a('<div class="bvviz-header-band"></div>')},headerContent:function(m){return a("<div>").append(a('<img class="bvviz-avatar" src="'+m.image+'" />'),a('<div class="bvviz-name">'+m.display_name+"</div>"))},subHeaderContent:function(m){var o=[],n=a('<div class="bvviz-desc">');if(a.isArray(m["rewards:currentlevels"])&&m["rewards:currentlevels"].length>0){o=Array.prototype.concat(o,a.map(m["rewards:currentlevels"],function(p){return p.name}))}if(a.isArray(m.teams)&&m.teams.length>0){o=Array.prototype.concat(o,a.map(m.teams,function(p){return p.display_name}))}if(o.length>0){n.append(o.join(" &#8226; "))}return n}},d=a.extend({},BVVIZ.options.playerCard,l),c=a.extend({visualization:"playerCard"},d.unitBar),e=["level","expertise","teams","activities"],k=["rewards:currentlevels","progresses:all_tracks","teams","activities"];function j(){g=a(g);if(g.length>1){return BVVIZ.helper.showError(g,'"target" argument must reference a single DOM node.')}if(!(a.isPlainObject(i)||typeof(i)==="string")||i.length<=0){return BVVIZ.helper.showError(g,'"player" argument must be an object or a string.')}if(BVVIZ.utility.validateNestedObj(d,"unitBar","modules")){a.each(e,function(m,n){if(a.inArray(n,d.unitBar.modules)<0){Array.prototype.splice.call(k,m,1,"")}});k=Array.prototype.filter.call(k,function(m){return m})}g.empty().addClass("bvviz bvviz-playerCard").append(b.header(),a('<div class="bvviz-body"></div>').append(a('<div class="bvviz-header-subband"></div>'),a('<div class="bvviz-card"></div>').append(a('<div class="bvviz-units"></div>'))));BVVIZ.helper.fitHeight(g);h()}function h(){var n=a(".bvviz-body-header",g),o=BVVIZ.helper.loading("bvviz-tr");g.append(o);var m=function(r){var q=a(".bvviz-header-band",g),p=a(".bvviz-header-subband",g);q.append(b.headerContent(r));p.append(b.subHeaderContent(r));BVVIZ.helper.unitBar(a(".bvviz-units",g),r,c);if(a.isFunction(BVVIZ.playerProfile)){q.add(p).bind("click",function(){BVVIZ.helper.showModal(BVVIZ.playerProfile,[r.id])})}o.remove()};if(a.isPlainObject(i)){m(i)}else{BVSDK("players",{players:i},{includes:k}).ok(function(p){m(p.players[0])}).fail(function(p){BVVIZ.helper.showError(g,p)})}}BVVIZ.waitForSiteCheck(function(m){if(m){j()}else{return false}});f.init=j;f.show=h;f.playerId=a.isPlainObject(i)?i.id:i;BVVIZ.instances=BVVIZ.instances||[];BVVIZ.instances.push(f);return f}})(jQuery);(function(a){BVVIZ.playerHeader=function(h,d,b){var g={},f=a.extend({},BVVIZ.options.playerHeader,b),c=a.extend({visualization:"playerHeader"},f.unitBar),e={card:function(k){var j=a('<div class="bvviz-card"><img class="bvviz-picture" src="'+k.image+'" /><div class="bvviz-name">'+k.display_name+'</div><div class="bvviz-units"></div></div>');window.setTimeout(function(){BVVIZ.helper.unitBar(a(".bvviz-units",j),k,c);j.append('<div class="bvviz-clear"></div>')},1);return j}};function i(j){h=a(h);if(h.length>1){return BVVIZ.helper.showError(h,'"target" argument must reference a single DOM node.')}if(!a.isPlainObject(j)){return BVVIZ.helper.showError(h,'"player" argument must be an object.')}h.empty().addClass("bvviz bvviz-playerHeader").append(a('<div class="bvviz-body"></div>').append(e.card(j)));if(a.isFunction(BVVIZ.playerProfile)){h.bind("click",function(){BVVIZ.helper.showModal(BVVIZ.playerProfile,[j.id])})}}BVVIZ.waitForSiteCheck(function(j){if(j){i(d)}else{return false}});g.init=i;g.playerId=d.id;BVVIZ.needsPlayer=true;g.needsPlayer=true;BVVIZ.instances=BVVIZ.instances||[];BVVIZ.instances.push(g);return g}})(jQuery);(function(a){BVVIZ.playerCollection=function(f,g,i,m){var d={},b=a.extend({},BVVIZ.options[i],m),h=a.isNumeric(b.pageSize)&&b.pageSize<30&&b.pageSize>0?b.pageSize:30,c=["level","expertise","teams","activities"],k=["rewards:currentlevels","progresses:all_tracks","teams","activities"],e=[],l={};function j(){var n;f=a(f);attrib=String.prototype.replace.call(g,/^data\-/,"");if(f.length==0){return BVVIZ.helper.showError(f,'"target" argument must reference a collection of DOM nodes.')}if(a("["+g+"]").length<1){return BVVIZ.helper.showError(f,'"dataAttr" argument must be a valid DOM attribute.')}f.map(function(){var o=a(this).data(attrib);if(e.length>=h){return false}if(a.type(o)==="string"&&String.prototype.match.call(o,/^[A-Fa-f\d]{24}$/)&&!l[o]){e.push(o);l[o]=true}});if(BVVIZ.utility.validateNestedObj(b,"unitBar","modules")){a.each(c,function(o,p){if(a.inArray(p,b.unitBar.modules)<0){Array.prototype.splice.call(k,o,1,"")}});k=Array.prototype.filter.call(k,function(o){return o})}n=BVVIZ.helper.loading("bvviz-tr");f.first().append(n);BVSDK("players",null,{query:{id:e},includes:k}).ok(function(o){if(a.isFunction(BVVIZ[i])){a.each(o.players,function(q,p){a("["+g+"="+p.id+"]").each(function(){a(this).empty().addClass("bvviz-invisible");BVVIZ[i](a(this),p,b)})});n.remove();BVVIZ.helper.showCollection(f)}else{n.remove()}}).fail(function(o){BVVIZ.helper.showError(f,o)})}BVVIZ.waitForSiteCheck(function(n){if(n){j()}else{return false}});d.init=j;return d}})(jQuery);(function(a){BVVIZ.playerRow=function(f,g,j){var e={},d=false,h=false,b={card:function(n,l){var k=a(),m=0;if(a.isArray(n["rewards:currentlevels"])){a.each(n["rewards:currentlevels"],function(p,q){var o;if(m>=l){return false}o=a('<div class="bvviz-data bvviz-level"><img src="'+q.image+'" /></div>');if(a.isFunction(BVVIZ.missionProgress)){o.click(function(r){BVVIZ.helper.showModal(BVVIZ.missionProgress,[n.id,q.mission_id]);r.preventDefault();return false})}k=k.add(o);m++})}if(a.isArray(n["progresses:all_tracks"])&&m<l){n["progresses:all_tracks"].sort(function(p,o){return o.percent-p.percent});a.each(n["progresses:all_tracks"],function(q,p){var o;if(m>=l){return false}if(p.percent>0&&p.type==="level_track"){o=a('<div class="bvviz-data bvviz-track"><img src="'+p.last_earned.image+'" /></div>');if(a.isFunction(BVVIZ.trackProgress)){o.click(function(r){BVVIZ.helper.showModal(BVVIZ.trackProgress,[n.id,p.definition_id]);r.preventDefault();return false})}k=k.add(o);m++}})}k=k.add(['<div class="bvviz-data bvviz-unit">','<div class="bvviz-value">',n.units.points.all,"</div>",'<div class="bvviz-label">',n.units.points.abbreviation,"</div>","</div>"].join(""));k=k.add('<div class="bvviz-clear"></div>');return k}},c;j=a.isPlainObject(j)?j:{maxIcons:parseInt(j,10)};if(!a.isNumeric(j.maxIcons)||j.maxIcons<0){delete j.maxIcons}c=a.extend({},BVVIZ.options.playerRow,j);function i(){f=a(f);if(f.length>1){return BVVIZ.helper.showError(f,'"target" argument must reference a single DOM node.')}if(typeof(g)!=="string"){if(typeof(g)!=="object"||!g.id){return BVVIZ.helper.showError(f,'"playerIdOrObject" argument must be a string or object.')}}else{if(g.length===0){return BVVIZ.helper.showError(f,'"playerIdOrObject" argument must be a string or object.')}}if(typeof(g)==="object"){h=g;d=g.id}else{d=g}f.empty().addClass("bvviz bvviz-playerRow").append(a('<div class="bvviz-row"></div>'));if(a.isFunction(BVVIZ.playerProfile)){f.bind("click",function(){BVVIZ.helper.showModal(BVVIZ.playerProfile,[d])})}if(!h){BVSDK("players",{players:d},{fields:"all",includes:"rewards:currentlevels,progresses:all_tracks"}).ok(function(k){h=k.players[0];f.find(".bvviz-row").append(b.card(h,c.maxIcons))})}else{f.find(".bvviz-row").append(b.card(h,c.maxIcons))}}BVVIZ.waitForSiteCheck(function(k){if(k){i(g)}else{return false}});e.init=i;if(typeof(g)==="string"){e.playerId=g}else{e.playerId=g.id}BVVIZ.instances=BVVIZ.instances||[];BVVIZ.instances.push(e);return e}})(jQuery);(function(a){BVVIZ.playerMissions=function(h,c,b){var f={},e={header:function(){return a('<div class="bvviz-header"><div class="bvviz-header-text">'+d.headerTitle+"</div></div>")},card:function(n){var l=!!(BVVIZ.utility.validateNestedObj(n,"image")&&n.image),j=!!(BVVIZ.utility.validateNestedObj(n,"progress","last_earned","image")&&n.progress.last_earned.image),m,k;if(n.type==="level"&&j){m=n.progress.last_earned.image}else{if(l){m=n.image}else{m=BVVIZ.helper.imageHolderSrc()}}k=a('<div class="bvviz-card bvviz-invisible"></div>').append(a('<img class="bvviz-picture'+(l?"":" bvviz-broken")+'" src="'+m+'" />'),(d.badges.showName?a('<div class="bvviz-name" title="'+n.name+'">'+n.name+"</div>"):""),(d.badges.showCategory?a('<div class="bvviz-category">'+n.category+"</div>"):""),(d.badges.showProgress?e.progress(n):""));if(n.type!=="level"&&!(a.isPlainObject(n.progress)&&n.progress.percent>=100)){k.addClass("bvviz-grey")}if(d.badges.miniBadge||!d.badges.showBadgeBorder){k.addClass("bvviz-borderless")}if(d.badges.badgeBackgroundColor){k.css("background-color",d.badges.badgeBackgroundColor)}if(d.badges.badgeFontColor){k.css("color",d.badges.badgeFontColor)}if(d.badges.miniBadge){k.addClass("bvviz-mini")}k.data("bvviz-mission",n.id);return k},progress:function(l){var k=l.progress,j=a('<div class="bvviz-progress"></div>');if(a.isPlainObject(k)){if(k.percent<100){j.html(k.earned+"/"+k.possible)}else{if(k.percent==100){if(l.type==="level"){j.html(k.earned+"/"+k.possible)}else{if(d.badges.miniBadge&&BVVIZ.utility.isIe8OrLess()){j.html("&#10003;")}else{if(d.badges.miniBadge){j.html(BVVIZ.helper.svgCheckmarkMini())}else{if(BVVIZ.utility.isIe8OrLess()){j.html("Completed").append(a('<div class="bvviz-checkmark-corner bvviz-nosvg"></div>'))}else{j.html("Completed").append(a('<div class="bvviz-checkmark-corner">'+BVVIZ.helper.svgCheckmarkCorner()+"</div>"))}}}}}}}return j}},d;b=a.isPlainObject(b)?b:{inline:!!b};if(b.childContentCards){b.inline=true}if(a.type(b.headerTitle)!=="string"||b.headerTitle==""){delete b.headerTitle}if(!a.isNumeric(b.pageSize)||b.pageSize<0||b.pageSize>BVVIZ.options.playerMissions.maxPageSize){delete b.pageSize}if(!b.category){delete b.category}else{if(a.type(b.category)==="string"){b.category=String.prototype.split.call(b.category,",")}else{if(a.type(b.category)!=="array"||b.category.length==0){delete b.category}}}BVVIZ.utility.trimArray(b.category);if(BVVIZ.utility.validateNestedObj(b,"badges")){if(a.type(b.badges.badgeBackgroundColor)!=="string"||!b.badges.badgeBackgroundColor.match(/^(#[0-9A-Fa-f]{3,6})|(\w)$/)){delete b.badges.badgeBackgroundColor}if(a.type(b.badges.badgeFontColor)!=="string"||!b.badges.badgeFontColor.match(/^(#[0-9A-Fa-f]{3,6})|(\w)$/)){delete b.badges.badgeFontColor}}d=a.extend({},BVVIZ.options.playerMissions,b);function i(){var j=a('<div class="bvviz-cards bvviz-row"></div>');h=a(h);if(h.length>1){return BVVIZ.helper.showError(h,'"target" argument must reference a single DOM node.')}if(typeof(c)!=="string"||c.length<=0){return BVVIZ.helper.showError(h,'"playerId" argument must be a string.')}h.empty().addClass("bvviz bvviz-playerMissions").append((d.inline?"":e.header()),(d.childContentCards?j:a('<div class="bvviz-body"></div>').append(j)));BVVIZ.helper.fitHeight(h);if(d.pageSize!==0){BVVIZ.helper.infiniteScroll(j,f)}g(0);if(a.isFunction(BVVIZ.missionProgress)){j.bind("click",function(m){var n=a(m.target),l=n.closest(".bvviz-card"),k;if(l.length>0){k=l.data("bvviz-mission");BVVIZ.helper.showModal(BVVIZ.missionProgress,[c,k]);m.preventDefault();return false}})}}function g(k){var n=BVVIZ.helper.loading("bvviz-tr"),m=a(".bvviz-cards",h),j=d.pageSize===0?d.maxPageSize:d.pageSize,l={fields:"parent_id,category",offset:k*j,limit:j};if(d.category){l=a.extend(true,l,{query:{category:d.category}})}if(!d.childContentCards){h.append(n)}BVSDK("missions",null,l).ok(function(o){var p=a.map(o.missions,function(q){if(!q.parent_id&&q.active){return q}});if(p.length>0){if(a.isFunction(d.beforeRequestCallback)){d.beforeRequestCallback()}BVSDK("players/progresses",{players:c},{query:{type:"all_missions",definition_id:a.map(p,function(q){return q.id})}}).ok(function(s){var q={},r;a.each(s.progresses,function(u,t){q[t.definition_id]=t});a.each(p,function(t,u){u.progress=q[u.id]||u.progress;m.append(e.card(u))});if(!d.childContentCards){if(!r){r=BVVIZ.helper.fitRowCardWidth(m.children(":first"),m)}m.children().width(r);n.remove();BVVIZ.helper.showCards(m)}}).always(function(){if(a.isFunction(d.callback)){d.callback()}})}else{n.remove()}if(d.pageSize===0){if(o.missions.length==j){BVVIZ.helper.loadNextPage(m,f)}}else{if(o.missions.length<j){m.unbind("scroll.bvviz")}else{if(p.length<=j/2){BVVIZ.helper.loadNextPage(m,f)}}}}).fail(function(){m.unbind("scroll.bvviz");n.remove()})}BVVIZ.waitForSiteCheck(function(j){if(j){i()}else{return false}});f.init=i;f.load=g;f.playerId=c;BVVIZ.instances=BVVIZ.instances||[];BVVIZ.instances.push(f);return f}})(jQuery);(function(a){BVVIZ.playerProfile=function(h,f,m){var g={},b={header:function(){return a('<div class="bvviz-header"></div>')},headerContent:function(){return a('<img class="bvviz-avatar" src="'+j.image+'" /><div class="bvviz-name">'+j.display_name+"</div>")},nav:function(){return a('<div class="bvviz-nav" data-bvviz-target="rewards">Rewards</div><div class="bvviz-nav" data-bvviz-target="missions">Missions</div><div class="bvviz-nav bvviz-last" data-bvviz-target="tracks">Tracks</div>')}},j,e=a.extend({},BVVIZ.options.playerProfile,m),c=a.extend({visualization:"playerProfile"},e.unitBar),d=["level","expertise","teams","activities"],l=["rewards:currentlevels","progresses:all_tracks","teams","activities"];function k(){var n=a('<div class="bvviz-body-header"></div>').append(b.nav());h=a(h);if(h.length>1){return BVVIZ.helper.showError(h,'"target" argument must reference a single DOM node.')}if(typeof(f)!=="string"||f.length<=0){return BVVIZ.helper.showError(h,'"playerId" argument must be a string.')}if(BVVIZ.utility.validateNestedObj(e,"unitBar","modules")){a.each(d,function(o,p){if(a.inArray(p,e.unitBar.modules)<0){Array.prototype.splice.call(l,o,1,"")}});l=Array.prototype.filter.call(l,function(o){return o})}h.empty().addClass("bvviz bvviz-playerProfile").append(b.header(),'<div class="bvviz-units"></div>',a('<div class="bvviz-body"></div>').append(n,'<div class="bvviz-cards bvviz-row"></div>'));i("player");n.bind("click",function(p){var q=a(p.target),o=q.data("bvviz-target");if(o){i(o)}p.preventDefault();return false})}function i(s){var q=a(".bvviz-body-header",h),r=BVVIZ.helper.loading("bvviz-tr"),n=a(".bvviz-nav[data-bvviz-target="+s+"]",q),o=h.find(".bvviz-cards:first"),p=a('<div class="bvviz-cards bvviz-row"></div>').height(o.height());n.siblings().removeClass("bvviz-active");n.addClass("bvviz-active");switch(s){case"player":h.append(r);BVSDK("players",{players:f},{includes:l}).ok(function(t){var u=a(".bvviz-header",h);j=t.players[0];u.append(b.headerContent());BVVIZ.helper.unitBar(a(".bvviz-units",h),j,c);r.remove();BVVIZ.helper.fitHeight(h);i(a(".bvviz-nav:first",q).data("bvviz-target"))}).fail(function(t){BVVIZ.helper.showError(h,t)});break;case"rewards":o.replaceWith(p);BVVIZ.playerRewards(p,f,true);break;case"missions":o.replaceWith(p);BVVIZ.playerMissions(p,f,true);break;case"tracks":o.replaceWith(p);BVVIZ.playerTracks(p,f,true);break}}BVVIZ.waitForSiteCheck(function(n){if(n){k()}else{return false}});g.init=k;g.show=i;g.playerId=f;BVVIZ.instances=BVVIZ.instances||[];BVVIZ.instances.push(g);return g}})(jQuery);(function(a){BVVIZ.playerRewards=function(f,d,j){var e={},b={header:function(){return a('<div class="bvviz-header"><div class="bvviz-header-text">'+c.headerTitle+"</div></div>")},card:function(m){var l=!!(BVVIZ.utility.validateNestedObj(m,"image")&&m.image),n=l?m.image:BVVIZ.helper.imageHolderSrc();n=!m.earned_by&&c.badges.lockUnearned?BVVIZ.helper.imageHolderSrc():n;var k=a('<div class="bvviz-card bvviz-invisible"></div>');if(c.badges.miniBadge){k.addClass("bvviz-mini").append(a('<img class="bvviz-picture'+(l?"":" bvviz-broken")+'" src="'+n+'" />'),(c.badges.showName?a('<div class="bvviz-name" title="'+m.name+'">'+m.name+"</div>"):""),(c.badges.showCategory?a('<div class="bvviz-category">'+m.category+"</div>"):""),(c.badges.showProgress?b.progress(m):""),b.count(m))}else{k.append(a('<img class="bvviz-picture'+(l?"":" bvviz-broken")+'" src="'+n+'" />'),(c.badges.showName?a('<div class="bvviz-name" title="'+m.name+'">'+m.name+"</div>"):""),(c.badges.showCategory?a('<div class="bvviz-category">'+m.category+"</div>"):""),(c.badges.showProgress?b.progress(m):""))}if(!m.earned_by){k.addClass("bvviz-grey");if(c.badges.lockUnearned){k.addClass("bvviz-locked")}}if(c.badges.miniBadge||!c.badges.showBadgeBorder){k.addClass("bvviz-borderless")}if(c.badges.badgeBackgroundColor){k.css("background-color",c.badges.badgeBackgroundColor)}if(c.badges.badgeFontColor){k.css("color",c.badges.badgeFontColor)}if(c.badges.miniBadge){k.addClass("bvviz-mini")}k.data("bvviz-reward",m.definition_id);return k},progress:function(m){var l=m.progress,k=a('<div class="bvviz-progress"></div>');if(a.isNumeric(m.earned_total_count)){if(c.badges.miniBadge&&BVVIZ.utility.isIe8OrLess()){k.html("&#10003;")}else{if(c.badges.miniBadge){k.html(BVVIZ.helper.svgCheckmarkMini())}else{if(BVVIZ.utility.isIe8OrLess()){k.html("Completed").append(a('<div class="bvviz-checkmark-corner bvviz-nosvg"></div>'))}else{k.html("Completed").append(a('<div class="bvviz-checkmark-corner">'+BVVIZ.helper.svgCheckmarkCorner()+"</div>"))}}}}else{if(a.isPlainObject(l)){k.html(l.earned+"/"+l.possible)}}return k},count:function(k){return k.earned_total_count?a('<div class="bvviz-count">'+k.earned_total_count+"x</div>"):""},dialog:function(k){return a('<div class="bvviz bvviz-playerRewards bvviz-dialog"><div class="bvviz-name">'+k.name+'</div><div class="bvviz-desc">'+k.hint+"</div></div>")}},c;j=a.isPlainObject(j)?j:{inline:!!j};if(j.childContentCards){j.inline=true}if(a.type(j.headerTitle)!=="string"||j.headerTitle==""){delete j.headerTitle}if(!a.isNumeric(j.pageSize)||j.pageSize<0||j.pageSize>BVVIZ.options.playerRewards.maxPageSize){delete j.pageSize}if(!j.category){delete j.category}else{if(a.type(j.category)==="string"){j.category=String.prototype.split.call(j.category,",")}else{if(a.type(j.category)!=="array"||j.category.length==0){delete j.category}}}BVVIZ.utility.trimArray(j.category);if(BVVIZ.utility.validateNestedObj(j,"badges")){if(a.type(j.badges.badgeBackgroundColor)!=="string"||!j.badges.badgeBackgroundColor.match(/^(#[0-9A-Fa-f]{3,6})|(\w)$/)){delete j.badges.badgeBackgroundColor}if(a.type(j.badges.badgeFontColor)!=="string"||!j.badges.badgeFontColor.match(/^(#[0-9A-Fa-f]{3,6})|(\w)$/)){delete j.badges.badgeFontColor}}c=a.extend({},BVVIZ.options.playerRewards,j);function i(){var k=a('<div class="bvviz-cards bvviz-row"></div>');f=a(f);if(f.length>1){return BVVIZ.helper.showError(f,'"target" argument must reference a single DOM node.')}if(typeof(d)!=="string"||d.length<=0){return BVVIZ.helper.showError(f,'"playerId" argument must be a string.')}f.empty().addClass("bvviz bvviz-playerRewards").append((c.inline?"":b.header()),(c.childContentCards?k:a('<div class="bvviz-body"></div>').append(k)));BVVIZ.helper.fitHeight(f);if(c.pageSize!==0){BVVIZ.helper.infiniteScroll(k,e)}h(0);if(a.isFunction(BVVIZ.rewardProgress)){k.bind("click",function(m){var n=a(m.target),l=n.closest(".bvviz-card"),o;if(l.length>0){o=l.data("bvviz-reward");BVVIZ.helper.showModal(BVVIZ.rewardProgress,[d,o]);m.preventDefault();return false}})}}function h(l){var n=BVVIZ.helper.loading("bvviz-tr"),m=a(".bvviz-cards",f),k=c.pageSize===0?c.maxPageSize:c.pageSize;if(!c.childContentCards){f.append(n)}BVSDK("rewards",null,{fields:["earnable_by","category","earned_total_count"],offset:l*k,limit:k,query:(c.category?{type:"Reward",active:true,category:c.category}:{type:"Reward",active:true})}).ok(function(p){var o=a.map(p.rewards,function(q){return q.earnable_by=="players"?q.id:null});if(p.rewards.length>0){if(a.isFunction(c.beforeRequestCallback)){c.beforeRequestCallback()}BVSDK.all(BVSDK("players/progresses",{players:d},{query:{type:"all_rewards",definition_id:o}}),BVSDK("players/rewards",{players:d},{fields:["category","earned_total_count"],distinct:"definition_id",query:{definition_id:o}})).ok(function(q,r){var t={},s;a.each(r.rewards,function(u,w){t[w.definition_id]=w;try{a.each(q.progresses,function(y,x){if(w.definition_id==x.definition_id){t[w.definition_id].progress=x}})}catch(v){}});a.each(p.rewards,function(u,v){try{a.each(q.progresses,function(y,x){if(v.id==x.definition_id){v.progress=x}})}catch(w){}if(v.earnable_by==="players"){if(c.badges.showUnearned){m.append(b.card(t[v.id]?t[v.id]:v))}else{if(t[v.id]){m.append(b.card(t[v.id]))}}}});if(!c.childContentCards){if(!s){s=BVVIZ.helper.fitRowCardWidth(m.children(":first"),m)}m.children().width(s);n.remove();BVVIZ.helper.showCards(m)}}).always(function(){if(a.isFunction(c.callback)){c.callback()}})}else{n.remove()}if(c.pageSize===0){if(p.rewards.length==k){BVVIZ.helper.loadNextPage(m,e)}}else{if(p.rewards.length<k){m.unbind("scroll.bvviz")}}}).fail(function(){m.unbind("scroll.bvviz");n.remove()})}function g(m){var o=m.data("bvviz-reward"),l=a('<div class="bvviz-overlay"></div>'),k=m.closest(".bvviz-body"),n;if(o&&a.isFunction(l.dialog)){n=b.dialog(o);l.bind("click",function(){a(".ui-dialog-titlebar-close",n.closest(".ui-dialog")).trigger("click")});a(".bvviz-overlay",m.parents(".bvviz-body").last()).click();m.parents(".bvviz-body").last().append(l);m.css("z-index",2);n.dialog({position:{my:"center top",at:"center bottom+5",of:m},resizable:false,draggable:false,width:(k.width()-(k.width()/3)),dialogClass:"bvviz",open:function(q,r){var p=a(".ui-dialog:last"),s=m.outerWidth(true)-m.width();p.css({left:f.offset().left+(k.width()/6)});a(".ui-dialog-content",p).css("min-height","0");a(".ui-dialog-titlebar-close",p).blur()},close:function(p,q){m.css("z-index","");l.remove();n.dialog("destroy")}})}}BVVIZ.waitForSiteCheck(function(k){if(k){i()}else{return false}});e.init=i;e.load=h;e.playerId=d;BVVIZ.instances=BVVIZ.instances||[];BVVIZ.instances.push(e);return e}})(jQuery);(function(a){BVVIZ.playerTracks=function(h,c,b){var f={},e={header:function(){return a('<div class="bvviz-header"><div class="bvviz-header-text">'+d.headerTitle+"</div></div>")},card:function(j){var m=!!(BVVIZ.utility.validateNestedObj(j,"image")&&j.image),k=!!(BVVIZ.utility.validateNestedObj(j,"progress","last_earned","image")&&j.progress.last_earned.image),n,l;if(j.type==="level"&&k){n=j.progress.last_earned.image}else{if(m){n=j.image}else{n=BVVIZ.helper.imageHolderSrc()}}l=a('<div class="bvviz-card bvviz-invisible"></div>').append(a('<img class="bvviz-picture'+(m?"":" bvviz-broken")+'" src="'+n+'" />'),(d.badges.showName?a('<div class="bvviz-name" title="'+j.name+'">'+j.name+"</div>"):""),(d.badges.showCategory?a('<div class="bvviz-category">'+j.category+"</div>"):""),(d.badges.showProgress?e.progress(j):""));if(j.type!=="level"&&!(a.isPlainObject(j.progress)&&j.progress.percent>=100)){l.addClass("bvviz-grey")}if(d.badges.miniBadge||!d.badges.showBadgeBorder){l.addClass("bvviz-borderless")}if(d.badges.badgeBackgroundColor){l.css("background-color",d.badges.badgeBackgroundColor)}if(d.badges.badgeFontColor){l.css("color",d.badges.badgeFontColor)}if(d.badges.miniBadge){l.addClass("bvviz-mini")}l.data("bvviz-track",j.id);return l},progress:function(k){var l=k.progress,j=a('<div class="bvviz-progress"></div>');if(a.isPlainObject(l)){if(l.percent<100){j.html(l.earned+"/"+l.possible)}else{if(l.percent==100){if(k.type==="level"){j.html(l.earned+"/"+l.possible)}else{if(d.badges.miniBadge&&BVVIZ.utility.isIe8OrLess()){j.html("&#10003;")}else{if(d.badges.miniBadge){j.html(BVVIZ.helper.svgCheckmarkMini())}else{if(BVVIZ.utility.isIe8OrLess()){j.html("Completed").append(a('<div class="bvviz-checkmark-corner bvviz-nosvg"></div>'))}else{j.html("Completed").append(a('<div class="bvviz-checkmark-corner">'+BVVIZ.helper.svgCheckmarkCorner()+"</div>"))}}}}}}}return j}},d;b=a.isPlainObject(b)?b:{inline:!!b};if(b.childContentCards){b.inline=true}if(a.type(b.headerTitle)!=="string"||b.headerTitle==""){delete b.headerTitle}if(!a.isNumeric(b.pageSize)||b.pageSize<0||b.pageSize>BVVIZ.options.playerTracks.maxPageSize){delete b.pageSize}if(!b.category){delete b.category}else{if(a.type(b.category)==="string"){b.category=String.prototype.split.call(b.category,",")}else{if(a.type(b.category)!=="array"||b.category.length==0){delete b.category}}}BVVIZ.utility.trimArray(b.category);if(BVVIZ.utility.validateNestedObj(b,"badges")){if(a.type(b.badges.badgeBackgroundColor)!=="string"||!b.badges.badgeBackgroundColor.match(/^(#[0-9A-Fa-f]{3,6})|(\w)$/)){delete b.badges.badgeBackgroundColor}if(a.type(b.badges.badgeFontColor)!=="string"||!b.badges.badgeFontColor.match(/^(#[0-9A-Fa-f]{3,6})|(\w)$/)){delete b.badges.badgeFontColor}}d=a.extend({},BVVIZ.options.playerTracks,b);function i(){var j=a('<div class="bvviz-cards bvviz-row"></div>');h=a(h);if(h.length>1){return BVVIZ.helper.showError(h,'"target" argument must reference a single DOM node.')}if(typeof(c)!=="string"||c.length<=0){return BVVIZ.helper.showError(h,'"playerId" argument must be a string.')}h.empty().addClass("bvviz bvviz-playerTracks").append((d.inline?"":e.header()),(d.childContentCards?j:a('<div class="bvviz-body"></div>').append(j)));BVVIZ.helper.fitHeight(h);if(d.pageSize!==0){BVVIZ.helper.infiniteScroll(j,f)}g(0);if(a.isFunction(BVVIZ.trackProgress)){j.bind("click",function(l){var n=a(l.target),k=n.closest(".bvviz-card"),m;if(k.length>0){m=k.data("bvviz-track");BVVIZ.helper.showModal(BVVIZ.trackProgress,[c,m]);l.preventDefault();return false}})}}function g(k){var n=BVVIZ.helper.loading("bvviz-tr"),m=a(".bvviz-cards",h),j=d.pageSize===0?d.maxPageSize:d.pageSize,l={fields:"category",offset:k*j,limit:j};if(d.category){l=a.extend(true,l,{query:{category:d.category}})}if(!d.childContentCards){h.append(n)}BVSDK("tracks",null,l).ok(function(p){var o=a.map(p.tracks,function(q){if(q.active){return q}});if(o.length>0){if(a.isFunction(d.beforeRequestCallback)){d.beforeRequestCallback()}BVSDK("players/progresses",{players:c},{query:{type:"all_tracks",definition_id:a.map(o,function(q){return q.id})}}).ok(function(q){var s={},r;a.each(q.progresses,function(u,t){s[t.definition_id]=t});a.each(o,function(t,u){u.progress=s[u.id]||u.progress;m.append(e.card(u))});if(!d.childContentCards){if(!r){r=BVVIZ.helper.fitRowCardWidth(m.children(":first"),m)}m.children().width(r);n.remove();BVVIZ.helper.showCards(m)}}).always(function(){if(a.isFunction(d.callback)){d.callback()}})}else{n.remove()}if(d.pageSize===0){if(p.tracks.length==j){BVVIZ.helper.loadNextPage(m,f)}}else{if(p.tracks.length<j){m.unbind("scroll.bvviz")}else{if(o.length<=j/2){BVVIZ.helper.loadNextPage(m,f)}}}}).fail(function(){m.unbind("scroll.bvviz");n.remove()})}BVVIZ.waitForSiteCheck(function(j){if(j){i()}else{return false}});f.init=i;f.load=g;f.playerId=c;BVVIZ.instances=BVVIZ.instances||[];BVVIZ.instances.push(f);return f}})(jQuery);(function(a){BVVIZ.playerStream=function(q,m,o,f){var l={},s={header:function(t){return a('<div class="bvviz-header"><div class="bvviz-header-text">'+t+"</div></div>")},activitiesCard:function(u){var t=BVVIZ.utility.validateNestedObj(u,"data","content","created_at")?u.data.content.created_at:BVVIZ.utility.validateNestedObj(u,"data","created_at")?u.data.created_at:new Date();var v=BVVIZ.utility.validateNestedObj(u,"data","image")&&u.data.image?u.data.image:BVVIZ.helper.imageHolderSrc();return a('<div class="bvviz-card '+h+'"></div>').append(v.match(/^[\w\s]*$/)?a('<span class="bvviz-picture"><span class="bvviz-sprite-icon '+v+'"></span></span>'):a('<img class="bvviz-picture" src="'+v+'" />'),a('<div class="bvviz-message">'+u.message+"</div>").append(BVVIZ.helper.timeToString(t)))},rewardsCard:function(t){var u=BVVIZ.utility.validateNestedObj(t,"data","image")&&t.data.image?t.data.image:BVVIZ.helper.imageHolderSrc();return a('<div class="bvviz-card '+h+'"></div>').append(a('<img class="bvviz-picture" src="'+u+'" />'),a('<div class="bvviz-message">'+t.message+"</div>").append(BVVIZ.helper.timeToString(t.data.created_at)))},missionsCard:function(t){var u=BVVIZ.utility.validateNestedObj(t,"data","image")&&t.data.image?t.data.image:BVVIZ.helper.imageHolderSrc();return a('<div class="bvviz-card '+h+'"></div>').append(a('<img class="bvviz-picture" src="'+u+'" />'),a('<div class="bvviz-message">'+t.message+"</div>").append(BVVIZ.helper.timeToString(t.data.created_at)))}},h="bvviz-odd",g,j,b=true,e,k=[],r=false,p;function n(){var t=BVVIZ.helper.loading("bvviz-tr");q=a(q);if(q.length>1){return BVVIZ.helper.showError(q,'"target" argument must reference a single DOM node.')}q.empty().addClass("bvviz bvviz-playerStream").append(a('<div class="bvviz-body bvviz-col"><div class="bvviz-cards bvviz-col"></div></div>'),t);g=a(".bvviz-cards",q);BVSDK("streams",{streams:m}).ok(function(u){t.remove();if(u.streams.length!==1){return BVVIZ.helper.showError(q,'Stream with id of "'+m+'" can not be found.')}if(u.streams[0].consumer!=="activity"){return BVVIZ.helper.showError(q,'Stream with id of "'+m+'" is not an "activity" stream.')}if(f){a(".bvviz-body",q).addClass("bvviz-noheader")}else{s.header(u.streams[0].name).prependTo(q)}BVVIZ.helper.fitHeight(q);BVSDK("streams/notifications",{streams:m},{fields:"all",source:{ids:[o]}}).ok(c).subscribe(c)}).fail(function(u){t.remove();BVVIZ.helper.showError(q,u)})}function c(u){var t=0;window.clearTimeout(e);k.push.apply(k,u.notifications);k.sort(function(w,v){return new Date(w.created_at)-new Date(v.created_at)});if(b){j=q.find(".bvviz-body").height();while(k.length>0&&t<=j){t+=d(k.shift(),true).outerHeight()}b=false}i()}function i(){if(r){return false}r=true;p=window.setInterval(function(){if(k.length===0){window.clearInterval(p);r=false;e=window.setTimeout(function(){BVSDK("streams/notifications",{streams:m},{fields:"all",source:{ids:[o]}}).ok(c)},60000);return false}d(k.shift())},2500)}function d(v,u){var t;if(s[v.type+"Card"]){t=s[v.type+"Card"](v);h=(h==="bvviz-odd"?"bvviz-even":"bvviz-odd")}else{return}if(!u){t.hide()}t.prependTo(g);if(!u){t.slideDown(1000,function(){var w=0;g.children().each(function(){if(w>j){a(this).remove()}else{w+=a(this).outerHeight()}})})}return t}BVVIZ.waitForSiteCheck(function(t){if(t){n()}else{return false}});l.init=n;return l}})(jQuery);(function(a){BVVIZ.customContainer=function(f,d,j){var e={},b={header:function(){return a('<div class="bvviz-header"><div class="bvviz-header-text">'+c.headerTitle+"</div></div>")},body:function(){var k=a('<div class="bvviz-body"></div>').append(b.description());if(!c.showContainerFrame){k.addClass("bvviz-noframe")}if(c.inline){k.addClass("bvviz-noheader")}return k},description:function(){var k=c.description?a('<div class="bvviz-body-title">'+c.description+"</div>"):"";if(c.description&&c.descriptionFontColor){k.css("color",c.descriptionFontColor)}return k}},c,g;j=a.isPlainObject(j)?j:{};if(!j.showContainerFrame){j.inline=true}if(a.type(j.headerTitle)!=="string"||j.headerTitle==""){delete j.headerTitle}if(!j.showDescription||a.type(j.description)!=="string"||j.description==""){delete j.description}if(a.type(j.descriptionFontColor)!=="string"||!j.descriptionFontColor.match(/^(#[0-9A-Fa-f]{3,6})|(\w)$/)){delete j.descriptionFontColor}if(!j.category){delete j.category}else{if(a.type(j.category)==="string"){j.category=String.prototype.split.call(j.category,",")}else{if(a.type(j.category)!=="array"||j.category.length==0){delete j.category}}}BVVIZ.utility.trimArray(j.category);if(a.type(j.contentsTypes)==="string"){j.contentsTypes=String.prototype.split.call(j.contentsTypes,",")}else{if(a.type(j.contentsTypes)!=="array"){delete j.contentsTypes}}BVVIZ.utility.trimArray(j.contentsTypes);if(BVVIZ.utility.validateNestedObj(j,"contents","badges")){if(a.type(j.contents.badges.badgeBackgroundColor)!=="string"||!j.contents.badges.badgeBackgroundColor.match(/^(#[0-9A-Fa-f]{3,6})|(\w)$/)){delete j.contents.badges.badgeBackgroundColor}if(a.type(j.contents.badges.badgeFontColor)!=="string"||!j.contents.badges.badgeFontColor.match(/^(#[0-9A-Fa-f]{3,6})|(\w)$/)){delete j.contents.badges.badgeFontColor}}c=a.extend({},BVVIZ.options.customContainer,j);g=a.extend({},j.contents,{inline:true,headerTitle:"",pageSize:0,childContentCards:true,category:c.category});function i(){f=a(f);if(f.length>1){return BVVIZ.helper.showError(f,'"target" argument must reference a single DOM node.')}if(typeof(d)!=="string"||d.length<=0){return BVVIZ.helper.showError(f,'"playerId" argument must be a string.')}f.empty().addClass("bvviz bvviz-customContainer").append((c.inline?"":b.header()),b.body());BVVIZ.helper.fitHeight(f);h()}function h(){var k=f.find(".bvviz-body"),r=BVVIZ.helper.loading("bvviz-tr"),n,m=0,q=0;f.append(r);k.find(".bvviz-cards").remove();function l(){a.each(f.find(".bvviz-cards"),function(s,t){t=a(t);if(!n){n=BVVIZ.helper.fitContainerCardWidth(k.find(".bvviz-card:first"),k)}t.children().width(n);BVVIZ.helper.showCards(t)});r.remove()}function p(){m++}function o(){q++;window.setTimeout(function(){if(q==m){l()}},10)}a.each(c.contentsTypes,function(u,v){var s,w,t;t={beforeRequestCallback:p,callback:o};switch(v){case"rewards":s=a.extend(true,{},BVVIZ.options.playerRewards,g,t);w=a("<div></div>").appendTo(k);BVVIZ.playerRewards(w,d,s);break;case"missions":s=a.extend(true,{},BVVIZ.options.playerMissions,g,t);w=a("<div></div>").appendTo(k);BVVIZ.playerMissions(w,d,s);break;case"tracks":s=a.extend(true,{},BVVIZ.options.playerTracks,g,t);w=a("<div></div>").appendTo(k);BVVIZ.playerTracks(w,d,s);break}});window.setTimeout(function(){r.remove()},3000)}BVVIZ.waitForSiteCheck(function(k){if(k){i()}else{return false}});e.init=i;e.load=h;e.playerId=d;BVVIZ.instances=BVVIZ.instances||[];BVVIZ.instances.push(e);return e}})(jQuery);(function(a){BVVIZ.rewardProgress=function(j,f,i,k){var g={},d={header:function(o){return a('<div class="bvviz-header"><div class="bvviz-header-text">'+o+"</div></div>")},bodyHeader:function(o){return a('<div class="bvviz-body-header"><div class="bvviz-percent">'+(o.progress&&o.progress.percent?o.progress.percent:0)+'%</div><div class="bvviz-hint">'+o.hint+"</div></div>")},defCard:function(p){var o=a('<div class="bvviz-card bvviz-invisible"></div>').append(a('<div class="bvviz-icon-container"></div>').append(a('<img class="bvviz-icon" src="'+p.image+'"/>')),a('<div class="bvviz-details"></div>').append(a('<div class="bvviz-hint">'+(p.hint?p.hint:"")+"</div>"),p.additionalAward?a('<div class="bvviz-awards bvviz-clearfix">Additional award: '+p.additionalAward+"</div>"):null,d.progress(p.playerProgress)));if(!p.earned_by){o.addClass("bvviz-grey")}return o},card:function(p){var o=a('<div class="bvviz-card bvviz-invisible"></div>').append(a('<div class="bvviz-icon-container"></div>').append(a('<img class="bvviz-icon" src="'+p.image+'"/>'),a('<div class="bvviz-count">'+p.earned_total_count+"x</div>")),a('<div class="bvviz-details"></div>').append(a('<div class="bvviz-message">'+(p.message?p.message:"")+"</div>"),p.additionalAward?a('<div class="bvviz-awards bvviz-clearfix">Additional award: '+p.additionalAward+"</div>"):null,a('<div class="bvviz-timestamp"><span>Completed: '+BVVIZ.helper.timeToFormatted(p.created_at)+"</span></div>")));if(!p.earned_by){o.addClass("bvviz-grey")}return o},resetCard:function(p){var o=a('<div class="bvviz-card bvviz-invisible"></div>').append(a('<div class="bvviz-icon-container"></div>').append(a('<img class="bvviz-icon" src="'+p.image+'"/>'),p.earned_total_count?a('<div class="bvviz-count">'+p.earned_total_count+"x</div>"):""),a('<div class="bvviz-details"></div>').append(a('<div class="bvviz-hint">'+(p.hint?p.hint:"")+"</div>"),p.additionalAward?a('<div class="bvviz-awards bvviz-clearfix">Additional award: '+p.additionalAward+"</div>"):null,d.progress(p.playerProgress),p.earned_total_count?a('<div class="bvviz-timestamp"><span>Completed: '+BVVIZ.helper.timeToFormatted(p.created_at)+"</span></div>"):""));if(!p.earned_by){o.addClass("bvviz-grey")}return o},progress:function(o){var o=a('<progress class="bvviz-progress-bar" max="'+o.possible+'" value="'+o.earned+'"></progress>').add(a('<div class="bvviz-ratio">'+o.earned+"/"+o.possible+"</div>"));return o},history:function(r){var o=a('<div class="bvviz-expand bvviz-arrowdown">&#9662;</div>'),q="",p="";a.each(r,function(t,s){q+="<div>"+BVVIZ.helper.timeToFormatted(s)+"</div>"});p=o.add(a('<div class="bvviz-more-timestamps"></div>').append(q));o.on("click",function(t){var s=a(this),u=s.next();if(!u.hasClass("bvviz-open")){s.html("&#9663");u.addClass("bvviz-open")}else{s.html("&#9662");u.removeClass("bvviz-open")}});return p}},b="bvviz-odd",l=10,c=false,e=false;function h(q){var r={},o="",p="";r.hint=q.hint?q.hint:(q.name+" to earn this reward");r.message=q.message?q.message:("Congratulations on earning reward "+q.name+"!");r.earned_total_count=a.isNumeric(q.earned_total_count)?q.earned_total_count:0;a.each(q.player_criteria,function(s,t){if(s>0){o+="</br>"+q.criteria_union+" "}o+=t.field+" "+t.operator+" "+t.value});r.eligibility=o?o:"N/A";a.each(q.units,function(s,t){if(t.possible==0){return}p=p?p+", ":p;p+=t.possible+" "+t.name});r.additionalAward=p;return a.extend(q,r,true)}function n(){var q=BVVIZ.helper.loading("bvviz-tr"),p="",o;j=a(j);if(j.length>1){return BVVIZ.helper.showError(j,'"target" argument must reference a single DOM node.')}if(typeof(f)!=="string"||f.length<=0){return BVVIZ.helper.showError(j,'"playerId" argument must be a string.')}if(typeof(i)!=="string"||i.length<=0){return BVVIZ.helper.showError(j,'"rewardId" argument must be a string.')}j.empty().addClass("bvviz bvviz-rewardProgress").append(a('<div class="bvviz-body bvviz-col"><div class="bvviz-cards bvviz-col"></div></div>'),q);o=a(".bvviz-cards",j);BVSDK.all(BVSDK("rewards",null,{fields:"all",query:{definition_id:i}}),BVSDK("players/rewards",{players:f},{fields:"all",distinct:"definition_id",query:{definition_id:i}})).ok(function(s,r){p=s.rewards&&s.rewards[0]&&s.rewards[0].name||"Unnamed Reward";if(!k){d.header(p).prependTo(j)}q.remove();BVVIZ.helper.fitHeight(j);m(s,r)}).fail(function(r){q.remove();BVVIZ.helper.showError(j,r)})}function m(q,v){var p=a(".bvviz-cards",j),t={},s=BVVIZ.helper.loading("bvviz-tr"),w=0;function o(y,x,A){var z={};if(y&&y.rewards&&y.rewards.length>0){z=a.extend(true,z,h(y.rewards[0]))}if(x&&x.rewards&&x.rewards.length>0){z=a.extend(true,z,h(x.rewards[0]))}if(A){if(A.progresses&&A.progresses.length>0){z.playerProgress=A.progresses[0]}else{z.playerProgress={earned:0,possible:(a.isNumeric(z.progress_possible)?z.progress_possible:1),percent:0}}}if(z&&a.isPlainObject(z.interval)){p.append(d.resetCard(z))}else{if(x&&x.rewards&&x.rewards.length>0){p.append(d.card(z))}else{p.append(d.defCard(z))}}if(p.children().length){s.remove();BVVIZ.helper.showCards(p)}else{s.remove();j.remove()}}function u(y){function x(){var B=a(".bvviz-count",p),A=a(".bvviz-timestamp",p),z;if(!a.isEmptyObject(t)){A.append(d.history(t));z=A.children().first();a(".bvviz-expand").css({left:A.width()-(A.width()-z.outerWidth())/2+5})}}BVSDK("players/rewards",{players:f},{fields:"created_at",offset:y*l,limit:l,query:{definition_id:i}}).ok(function(z){if(z){a.each(z.rewards,function(A,B){if(v&&v.rewards.length>0&&v.rewards[0].id!==B.id){t[B.id]=B.created_at}w++})}if(z.rewards&&z.rewards.length===l){y++;u(y)}else{x()}}).fail(function(z){x()})}function r(y,x){BVSDK("players/progresses",{players:f},{fields:"all",query:{type:"all_rewards",definition_id:i}}).ok(function(A){var z=a(".bvviz-details",p);if(BVVIZ.utility.validateNestedObj(A,"progresses")){if(y&&y.rewards&&y.rewards[0]){y.rewards[0].playerProgress=A.progresses[0]}if(A.progresses.length){if(z.length>0){z.append(d.progress(A.progresses[0]))}}}}).always(function(z){o(y,x,z);if(BVVIZ.utility.validateNestedObj(x,"rewards")){if(x.rewards[0]&&x.rewards[0].interval){u(0)}}})}j.append(s);if(v.rewards&&v.rewards.length>0){if(v.rewards[0]&&v.rewards[0].interval){r(q,v)}else{o(q,v);if(v.rewards[0].allow_duplicates){u(0)}}}else{r(q)}}BVVIZ.waitForSiteCheck(function(o){if(o){n()}else{return false}});g.init=n;g.playerId=f;BVVIZ.instances=BVVIZ.instances||[];BVVIZ.instances.push(g);return g}})(jQuery);(function(a){BVVIZ.trackProgress=function(j,h,f,m){var i={},d={header:function(n){return a('<div class="bvviz-header"><div class="bvviz-header-text">'+n+"</div></div>")},bodyHeader:function(n){return a('<div class="bvviz-body-header"><div class="bvviz-percent">'+(n.progress.percent?n.progress.percent:0)+'%</div><div class="bvviz-hint">'+n.hint+"</div></div>")},card:function(o){var n=a('<div class="bvviz-card bvviz-invisible"></div>').append(a('<div class="bvviz-picture-container"></div>').append('<img class="bvviz-picture" src="'+o.image+'"/><div class="bvviz-bridge"></div>'),a('<div class="bvviz-details"></div>').append(a('<div class="bvviz-name">'+o.name+"</div>"),a('<div class="bvviz-desc">'+o.hint+"</div>")),'<div class="bvviz-percent">'+(o.progress.percent?o.progress.percent:0)+"%</div>");if(!o.progress.percent||o.progress.percent<100){n.addClass("bvviz-grey")}n.data("bvviz-mission",o.id);return n}},b="bvviz-odd",c=false,e=true,g;m=a.isPlainObject(m)?m:{inline:!!m};if(m.childContentCards){m.inline=true}if(a.type(m.headerTitle)!=="string"||m.headerTitle==""){delete m.headerTitle}if(!a.isNumeric(m.pageSize)||m.pageSize<0||m.pageSize>BVVIZ.options.trackProgress.maxPageSize){delete m.pageSize}g=a.extend({},BVVIZ.options.trackProgress,m);function l(){var n=BVVIZ.helper.loading("bvviz-tr");j=a(j);if(j.length>1){return BVVIZ.helper.showError(j,'"target" argument must reference a single DOM node.')}if(typeof(h)!=="string"||h.length<=0){return BVVIZ.helper.showError(j,'"playerId" argument must be a string.')}if(typeof(f)!=="string"||f.length<=0){return BVVIZ.helper.showError(j,'"trackId" argument must be a string.')}j.empty().addClass("bvviz bvviz-trackProgress").append(a('<div class="bvviz-body bvviz-col"><div class="bvviz-cards bvviz-col"></div></div>'),n);BVSDK.all(BVSDK("tracks",{tracks:f},{fields:"hint"}),BVSDK("players/progresses",{players:h},{query:{type:"all_tracks",definition_id:f}})).ok(function(q,p){var o=a(".bvviz-cards",j);if(!g.inline){d.header(q.tracks[0].name).prependTo(j)}if(p&&a.isArray(p.progresses)&&p.progresses.length>0){q.tracks[0].progress=p.progresses[0];c=p.progresses[0].percent>0}d.bodyHeader(q.tracks[0]).prependTo(a(".bvviz-body",j));n.remove();BVVIZ.helper.fitHeight(j);BVVIZ.helper.infiniteScroll(o,i);if(q.tracks[0].type=="random"||q.tracks[0].type=="unordered"){e=false}k(0);if(a.isFunction(BVVIZ.missionProgress)){o.bind("click",function(t){var u=a(t.target),s=u.closest(".bvviz-card"),r;if(s.length>0){r=s.data("bvviz-mission");BVVIZ.helper.showModal(BVVIZ.missionProgress,[h,r]);t.preventDefault();return false}})}}).fail(function(o){n.remove();BVVIZ.helper.showError(j,o)})}function k(p){var q=a(".bvviz-cards",j),n=g.pageSize===0?g.maxPageSize:g.pageSize,r=BVVIZ.helper.loading("bvviz-tr");function o(u,t){var s={};if(t){a.each(t.missions,function(v,w){s[w.id]=w})}a.each(u.missions,function(v,w){q.append(d.card(s[w.id]||w).addClass(b));b=b==="bvviz-odd"?"bvviz-even":"bvviz-odd"});if(e===false){a(".bvviz-bridge",q).remove()}if(p===0){if(e){a(".bvviz-bridge:first",q).remove()}a(".bvviz-card:first",q).addClass("bvviz-first")}r.remove();BVVIZ.helper.showCards(q)}j.append(r);BVSDK("tracks/missions",{tracks:f},{fields:"hint",offset:p*n,limit:n}).ok(function(s){BVSDK("players/missions",{players:h},{fields:"hint",query:{id:a.map(s.missions,function(t){return t.id})}}).ok(function(t){o(s,t)});if(s.missions.length<n){q.unbind("scroll.bvviz")}else{BVVIZ.helper.loadNextPage(q,i)}}).fail(function(){q.unbind("scroll.bvviz");r.remove()})}BVVIZ.waitForSiteCheck(function(n){if(n){l()}else{return false}});i.init=l;i.load=k;i.playerId=h;BVVIZ.instances=BVVIZ.instances||[];BVVIZ.instances.push(i);return i}})(jQuery);(function(a){BVVIZ.trackMissions=function(g,e,c,j){var f={},b={header:function(k){return a('<div class="bvviz-header"><div class="bvviz-header-text">'+(d.headerTitle?d.headerTitle:k)+"</div></div>")},body:function(){var k=a('<div class="bvviz-body"></div>').append(b.description());if(!d.showContainerFrame){k.addClass("bvviz-noframe")}if(d.inline){k.addClass("bvviz-noheader")}return k},description:function(){var k=d.description?a('<div class="bvviz-body-title">'+d.description+"</div>"):"";if(d.description&&d.descriptionFontColor){k.css("color",d.descriptionFontColor)}return k},card:function(n){var l=!!(BVVIZ.utility.validateNestedObj(n,"image")&&n.image),m=l?n.image:BVVIZ.helper.imageHolderSrc();var k=a('<div class="bvviz-card bvviz-invisible"></div>').append(a('<img class="bvviz-picture'+(l?"":" bvviz-broken")+'" src="'+m+'" />'),(d.badges.showName?a('<div class="bvviz-name" title="'+n.name+'">'+n.name+"</div>"):""),(d.badges.showProgress?b.progress(n):""));if(!(a.isPlainObject(n.progress)&&n.progress.percent>=100)){k.addClass("bvviz-grey")}if(d.badges.miniBadge||!d.badges.showBadgeBorder){k.addClass("bvviz-borderless")}if(d.badges.badgeBackgroundColor){k.css("background-color",d.badges.badgeBackgroundColor)}if(d.badges.badgeFontColor){k.css("color",d.badges.badgeFontColor)}if(d.badges.miniBadge){k.addClass("bvviz-mini")}k.data("bvviz-mission",n.id);return k},progress:function(m){var l=m.progress,k=a('<div class="bvviz-progress"></div>');if(a.isPlainObject(l)){if(l.percent<100){k.html(l.earned+"/"+l.possible)}else{if(l.percent==100){if(m.type==="level"){k.html(l.earned+"/"+l.possible)}else{if(d.badges.miniBadge&&BVVIZ.utility.isIe8OrLess()){k.html("&#10003;")}else{if(d.badges.miniBadge){k.html(BVVIZ.helper.svgCheckmarkMini())}else{if(BVVIZ.utility.isIe8OrLess()){k.html("Completed").append(a('<div class="bvviz-checkmark-corner bvviz-nosvg"></div>'))}else{k.html("Completed").append(a('<div class="bvviz-checkmark-corner">'+BVVIZ.helper.svgCheckmarkCorner()+"</div>"))}}}}}}}return k}},d;j=a.isPlainObject(j)?j:{inline:!!j};if(!j.showContainerFrame||j.childContentCards){j.inline=true}if(a.type(j.headerTitle)!=="string"||j.headerTitle==""){delete j.headerTitle}if(!j.showDescription||a.type(j.description)!=="string"||j.description==""){delete j.description}if(a.type(j.descriptionFontColor)!=="string"||!j.descriptionFontColor.match(/^(#[0-9A-Fa-f]{3,6})|(\w)$/)){delete j.descriptionFontColor}if(!a.isNumeric(j.pageSize)||j.pageSize<0||j.pageSize>BVVIZ.options.trackMissions.maxPageSize){delete j.pageSize}if(BVVIZ.utility.validateNestedObj(j,"badges")){if(a.type(j.badges.badgeBackgroundColor)!=="string"||!j.badges.badgeBackgroundColor.match(/^(#[0-9A-Fa-f]{3,6})|(\w)$/)){delete j.badges.badgeBackgroundColor}if(a.type(j.badges.badgeFontColor)!=="string"||!j.badges.badgeFontColor.match(/^(#[0-9A-Fa-f]{3,6})|(\w)$/)){delete j.badges.badgeFontColor}}d=a.extend({},BVVIZ.options.trackMissions,j);function i(){var k=a('<div class="bvviz-cards bvviz-row"></div>');g=a(g);if(g.length>1){return BVVIZ.helper.showError(g,'"target" argument must reference a single DOM node.')}if(typeof(e)!=="string"||e.length<=0){return BVVIZ.helper.showError(g,'"playerId" argument must be a string.')}g.empty().addClass("bvviz bvviz-trackMissions").append((d.childContentCards?k:b.body().append(k)));BVSDK("tracks",{tracks:c}).ok(function(l){if(!d.inline){b.header(l.tracks[0].name).prependTo(g)}BVVIZ.helper.fitHeight(g);if(d.pageSize!==0){BVVIZ.helper.infiniteScroll(k,f)}h(0)}).fail(function(l){BVVIZ.helper.showError(g,l)});if(a.isFunction(BVVIZ.missionProgress)){k.bind("click",function(n){var o=a(n.target),m=o.closest(".bvviz-card"),l;if(m.length>0){l=m.data("bvviz-mission");BVVIZ.helper.showModal(BVVIZ.missionProgress,[e,l]);n.preventDefault();return false}})}}function h(l){var o=BVVIZ.helper.loading("bvviz-tr"),n=a(".bvviz-cards",g),k=d.pageSize===0?d.maxPageSize:d.pageSize,m={offset:l*k,limit:k};if(!d.childContentCards){g.append(o)}BVSDK("tracks/missions",{tracks:c},m).ok(function(p){var q=a.map(p.missions,function(r){if(r.active){return r}});if(q.length>0){if(a.isFunction(d.beforeRequestCallback)){d.beforeRequestCallback()}BVSDK.all(BVSDK("players/missions",{players:e},{query:{id:a.map(q,function(r){return r.id})}}),BVSDK("players/progresses",{players:e},{query:{type:"all_missions",definition_id:a.map(q,function(r){return r.id})}})).ok(function(u,r){var s={},t;if(u&&u.missions){a.each(u.missions,function(v,w){s[w.id]=w})}a.each(q,function(v,w){try{a.each(r.progresses,function(z,y){if(w.id==y.definition_id){s[w.id]=w;s[w.id].progress=y}})}catch(x){}n.append(b.card(s[w.id]?s[w.id]:w))});if(!d.childContentCards){if(!t){t=BVVIZ.helper.fitRowCardWidth(n.children(":first"),n)}n.children().width(t);o.remove();BVVIZ.helper.showCards(n)}}).always(function(){if(a.isFunction(d.callback)){d.callback()}})}else{o.remove()}if(p.missions.length<k){n.unbind("scroll.bvviz")}else{BVVIZ.helper.loadNextPage(n,f)}}).fail(function(){n.unbind("scroll.bvviz");o.remove()})}BVVIZ.waitForSiteCheck(function(k){if(k){i()}else{return false}});f.init=i;f.load=h;f.playerId=e;BVVIZ.instances=BVVIZ.instances||[];BVVIZ.instances.push(f);return f}})(jQuery);(function(a){BVVIZ.siteStream=function(k,b,l){var g={},f={header:function(s){return a('<div class="bvviz-header"><div class="bvviz-header-text">'+s+"</div></div>")},activitiesCard:function(t){var s=BVVIZ.utility.validateNestedObj(t,"data","content","created_at")?t.data.content.created_at:BVVIZ.utility.validateNestedObj(t,"data","created_at")?t.data.created_at:new Date();var u=BVVIZ.utility.validateNestedObj(t,"data","image")&&t.data.image?t.data.image:BVVIZ.helper.imageHolderSrc();return a('<div class="bvviz-card '+c+'"></div>').append(u.match(/^[\w\s]*$/)?a('<span class="bvviz-picture"><span class="bvviz-sprite-icon '+u+'"></span></span>'):a('<img class="bvviz-picture" src="'+u+'" />'),a('<div class="bvviz-message">'+t.message+"</div>").append(BVVIZ.helper.timeToString(s)))},rewardsCard:function(s){var t=BVVIZ.utility.validateNestedObj(s,"data","image")&&s.data.image?s.data.image:BVVIZ.helper.imageHolderSrc();return a('<div class="bvviz-card '+c+'"></div>').append(a('<img class="bvviz-picture" src="'+t+'" />'),a('<div class="bvviz-message">'+s.message+"</div>").append(BVVIZ.helper.timeToString(s.data.created_at)))},missionsCard:function(s){var t=BVVIZ.utility.validateNestedObj(s,"data","image")&&s.data.image?s.data.image:BVVIZ.helper.imageHolderSrc();return a('<div class="bvviz-card '+c+'"></div>').append(a('<img class="bvviz-picture" src="'+t+'" />'),a('<div class="bvviz-message">'+s.message+"</div>").append(BVVIZ.helper.timeToString(s.data.created_at)))}},c="bvviz-odd",d,q,j=true,n,h=[],i=false,m;function r(){var s=BVVIZ.helper.loading("bvviz-tr");k=a(k);if(k.length>1){return BVVIZ.helper.showError(k,'"target" argument must reference a single DOM node.')}k.empty().addClass("bvviz bvviz-siteStream").append(a('<div class="bvviz-body bvviz-col"><div class="bvviz-cards bvviz-col"></div></div>'),s);d=a(".bvviz-cards",k);BVSDK("streams",{streams:b}).ok(function(t){s.remove();if(t.streams.length!==1){return BVVIZ.helper.showError(k,'Stream with id of "'+b+'" can not be found.')}if(t.streams[0].consumer!=="site"){return BVVIZ.helper.showError(k,'Stream with id of "'+b+'" is not a "site" stream.')}if(l){a(".bvviz-body",k).addClass("bvviz-noheader")}else{f.header(t.streams[0].name).prependTo(k)}BVVIZ.helper.fitHeight(k);BVSDK("streams/notifications",{streams:b},{fields:"all"}).ok(e).subscribe(e)}).fail(function(t){s.remove();BVVIZ.helper.showError(k,t)})}function e(t){var s=0;window.clearTimeout(n);h.push.apply(h,t.notifications);h.sort(function(v,u){return new Date(v.created_at)-new Date(u.created_at)});if(j){q=k.find(".bvviz-body").height();while(h.length>0&&s<=q){s+=p(h.shift(),true).outerHeight()}j=false}o()}function o(){if(i){return false}i=true;m=window.setInterval(function(){if(h.length===0){window.clearInterval(m);i=false;n=window.setTimeout(function(){BVSDK("streams/notifications",{streams:b},{fields:"all"}).ok(e)},60000);return false}p(h.shift())},2500)}function p(u,t){var s;if(f[u.type+"Card"]){s=f[u.type+"Card"](u);c=(c==="bvviz-odd"?"bvviz-even":"bvviz-odd")}else{return}if(!t){s.hide()}s.prependTo(d);if(!t){s.slideDown(1000,function(){var v=0;d.children().each(function(){if(v>q){a(this).remove()}else{v+=a(this).outerHeight()}})})}return s}BVVIZ.waitForSiteCheck(function(s){if(s){r()}else{return false}});g.init=r;return g}})(jQuery);(function(a){BVVIZ.followingStream=function(q,m,o,f){var l={},s={header:function(t){return a('<div class="bvviz-header"><div class="bvviz-header-text">'+t+"</div></div>")},activitiesCard:function(u){var t=BVVIZ.utility.validateNestedObj(u,"data","content","created_at")?u.data.content.created_at:BVVIZ.utility.validateNestedObj(u,"data","created_at")?u.data.created_at:new Date();var v=BVVIZ.utility.validateNestedObj(u,"data","image")&&u.data.image?u.data.image:BVVIZ.helper.imageHolderSrc();return a('<div class="bvviz-card '+h+'"></div>').append(v.match(/^[\w\s]*$/)?a('<span class="bvviz-picture"><span class="bvviz-sprite-icon '+v+'"></span></span>'):a('<img class="bvviz-picture" src="'+v+'" />'),a('<div class="bvviz-message">'+u.message+"</div>").append(BVVIZ.helper.timeToString(t)))},rewardsCard:function(t){var u=BVVIZ.utility.validateNestedObj(t,"data","image")&&t.data.image?t.data.image:BVVIZ.helper.imageHolderSrc();return a('<div class="bvviz-card '+h+'"></div>').append(a('<img class="bvviz-picture" src="'+u+'" />'),a('<div class="bvviz-message">'+t.message+"</div>").append(BVVIZ.helper.timeToString(t.data.created_at)))},missionsCard:function(t){var u=BVVIZ.utility.validateNestedObj(t,"data","image")&&t.data.image?t.data.image:BVVIZ.helper.imageHolderSrc();return a('<div class="bvviz-card '+h+'"></div>').append(a('<img class="bvviz-picture" src="'+u+'" />'),a('<div class="bvviz-message">'+t.message+"</div>").append(BVVIZ.helper.timeToString(t.data.created_at)))}},h="bvviz-odd",g,j,b=true,e,k=[],r=false,p;function n(){var t=BVVIZ.helper.loading("bvviz-tr");q=a(q);if(q.length>1){return BVVIZ.helper.showError(q,'"target" argument must reference a single DOM node.')}q.empty().addClass("bvviz bvviz-followingStream").append(a('<div class="bvviz-body bvviz-col"><div class="bvviz-cards bvviz-col"></div></div>'),t);g=a(".bvviz-cards",q);BVSDK("streams",{streams:m}).ok(function(u){t.remove();if(u.streams.length!==1){return BVVIZ.helper.showError(q,'Stream with id of "'+m+'" can not be found.')}if(u.streams[0].consumer!=="activity"){return BVVIZ.helper.showError(q,'Stream with id of "'+m+'" is not an "activity" stream.')}if(f){a(".bvviz-body",q).addClass("bvviz-noheader")}else{s.header(u.streams[0].name).prependTo(q)}BVVIZ.helper.fitHeight(q);BVSDK("streams/notifications",{streams:m},{fields:"all",source:{map:{name:"following",target:o}},requester:o}).ok(c).subscribe(c)}).fail(function(u){t.remove();BVVIZ.helper.showError(q,u)})}function c(u){var t=0;window.clearTimeout(e);k.push.apply(k,u.notifications);k.sort(function(w,v){return new Date(w.created_at)-new Date(v.created_at)});if(b){j=q.find(".bvviz-body").height();while(k.length>0&&t<=j){t+=d(k.shift(),true).outerHeight()}b=false}i()}function i(){if(r){return false}r=true;p=window.setInterval(function(){if(k.length===0){window.clearInterval(p);r=false;e=window.setTimeout(function(){BVSDK("streams/notifications",{streams:m},{fields:"all",source:{map:{name:"following",target:o}},requester:o}).ok(c)},60000);return false}d(k.shift())},2500)}function d(v,u){var t;if(s[v.type+"Card"]){t=s[v.type+"Card"](v);h=(h==="bvviz-odd"?"bvviz-even":"bvviz-odd")}else{return}if(!u){t.hide()}t.prependTo(g);if(!u){t.slideDown(1000,function(){var w=0;g.children().each(function(){if(w>j){a(this).remove()}else{w+=a(this).outerHeight()}})})}return t}BVVIZ.waitForSiteCheck(function(t){if(t){n()}else{return false}});l.init=n;return l}})(jQuery);